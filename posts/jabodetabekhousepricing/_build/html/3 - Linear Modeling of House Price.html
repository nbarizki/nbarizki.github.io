
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Linear Regression Model of House Price in Jabodetabek Area and its Implementation &#8212; Linear Regression of Jabodetabek House Price and Implementation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Data Exploration and Analysis of House Price Offers" href="2%20-%20Data%20Exploration%20and%20Analysis.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Linear Regression of Jabodetabek House Price and Implementation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Linear Regression Model of Jabodetabek House Price and its Implementation
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1%20-%20Data%20Pre-Processing.html">
   <strong>
    Data Pre-Processing
   </strong>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2%20-%20Data%20Exploration%20and%20Analysis.html">
   <strong>
    Data Exploration and Analysis of House Price Offers
   </strong>
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   <strong>
    Linear Regression Model of House Price in Jabodetabek Area and its Implementation
   </strong>
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/nbarizki/jabodetabekhousepricing/main?urlpath=tree/3 - Linear Modeling of House Price.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/nbarizki/jabodetabekhousepricing"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/nbarizki/jabodetabekhousepricing/issues/new?title=Issue%20on%20page%20%2F3 - Linear Modeling of House Price.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/3 - Linear Modeling of House Price.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   <strong>
    Linear Regression Model of House Price in Jabodetabek Area and its Implementation
   </strong>
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#contents">
     Contents
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   1. Introduction
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     <strong>
      About this Notebook
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-the-dataset-and-modules">
   2. Preparing the Dataset and Modules
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-modeling">
   3. Linear Modeling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-linear-regression">
     3.1. Simple Linear Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#residual-analysis-of-simple-linear-regression">
       <strong>
        Residual Analysis of Simple Linear Regression
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dealing-with-non-constant-variance">
       <strong>
        Dealing with Non-Constant Variance
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outliers-detection-studentized-residual-leverage-point-cook-distance">
       <strong>
        Outliers Detection: Studentized Residual, Leverage Point, Cook Distance
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inference-of-building-size-m2-parameter-and-mean-response">
       <strong>
        Inference of
        <code class="docutils literal notranslate">
         <span class="pre">
          building_size_m2
         </span>
        </code>
        parameter  and
        <code class="docutils literal notranslate">
         <span class="pre">
          mean
         </span>
         <span class="pre">
          response
         </span>
        </code>
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prediction-interval-of-simple-regression">
       <strong>
        Prediction Interval of Simple Regression
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conclusion-simple-linear-regression">
       <strong>
        Conclusion: Simple Linear Regression
       </strong>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-linear-regression">
     3.2. Multiple Linear Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multicollinearity">
       <strong>
        Multicollinearity
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#features-significancy">
       <strong>
        Features Significancy
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optimizing-multiple-regression">
       <strong>
        Optimizing Multiple Regression
       </strong>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#predictive-performance-of-linear-model">
   4. Predictive Performance of Linear Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation-of-parametric-model-way-to-maximize-house-selling-profit-for-developer">
   5. Implementation of Parametric Model: Way to Maximize House-Selling Profit for Developer
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#case-example">
     5.1. Case Example
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     5.2. Solution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#assumption">
       <strong>
        Assumption
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#general-parameters">
       <strong>
        General Parameters
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sentiment-about-building-size">
       <strong>
        Sentiment about Building Size
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#c-mathematical-problems-to-solve">
       <strong>
        C. Mathematical Problems to Solve
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-optimization-function-and-implementation-using-pyomo">
       <strong>
        Solution: Optimization Function and Implementation using
        <em>
         Pyomo
        </em>
       </strong>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#closing">
   6. Closing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusion">
     6.1. Conclusion
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#further-improvement">
     6.2. Further Improvement
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   7. References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Linear Regression Model of House Price in Jabodetabek Area and its Implementation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   <strong>
    Linear Regression Model of House Price in Jabodetabek Area and its Implementation
   </strong>
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#contents">
     Contents
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   1. Introduction
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     <strong>
      About this Notebook
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-the-dataset-and-modules">
   2. Preparing the Dataset and Modules
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-modeling">
   3. Linear Modeling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-linear-regression">
     3.1. Simple Linear Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#residual-analysis-of-simple-linear-regression">
       <strong>
        Residual Analysis of Simple Linear Regression
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dealing-with-non-constant-variance">
       <strong>
        Dealing with Non-Constant Variance
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outliers-detection-studentized-residual-leverage-point-cook-distance">
       <strong>
        Outliers Detection: Studentized Residual, Leverage Point, Cook Distance
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inference-of-building-size-m2-parameter-and-mean-response">
       <strong>
        Inference of
        <code class="docutils literal notranslate">
         <span class="pre">
          building_size_m2
         </span>
        </code>
        parameter  and
        <code class="docutils literal notranslate">
         <span class="pre">
          mean
         </span>
         <span class="pre">
          response
         </span>
        </code>
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prediction-interval-of-simple-regression">
       <strong>
        Prediction Interval of Simple Regression
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conclusion-simple-linear-regression">
       <strong>
        Conclusion: Simple Linear Regression
       </strong>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-linear-regression">
     3.2. Multiple Linear Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multicollinearity">
       <strong>
        Multicollinearity
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#features-significancy">
       <strong>
        Features Significancy
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optimizing-multiple-regression">
       <strong>
        Optimizing Multiple Regression
       </strong>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#predictive-performance-of-linear-model">
   4. Predictive Performance of Linear Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation-of-parametric-model-way-to-maximize-house-selling-profit-for-developer">
   5. Implementation of Parametric Model: Way to Maximize House-Selling Profit for Developer
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#case-example">
     5.1. Case Example
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     5.2. Solution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#assumption">
       <strong>
        Assumption
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#general-parameters">
       <strong>
        General Parameters
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sentiment-about-building-size">
       <strong>
        Sentiment about Building Size
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#c-mathematical-problems-to-solve">
       <strong>
        C. Mathematical Problems to Solve
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-optimization-function-and-implementation-using-pyomo">
       <strong>
        Solution: Optimization Function and Implementation using
        <em>
         Pyomo
        </em>
       </strong>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#closing">
   6. Closing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusion">
     6.1. Conclusion
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#further-improvement">
     6.2. Further Improvement
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   7. References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="linear-regression-model-of-house-price-in-jabodetabek-area-and-its-implementation">
<h1><strong>Linear Regression Model of House Price in Jabodetabek Area and its Implementation</strong><a class="headerlink" href="#linear-regression-model-of-house-price-in-jabodetabek-area-and-its-implementation" title="Permalink to this headline">#</a></h1>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">#</a></h2>
<p><strong><a class="reference external" href="#1_introduction">1. Introduction</a></strong></p>
<p><strong><a class="reference external" href="#2_preparing_the_dataset">2. Preparing the Dataset and Modules</a></strong></p>
<p><strong><a class="reference external" href="#3_linear_modeling">3. Linear Modeling</a></strong></p>
<p><strong><a class="reference external" href="#3_1_simple_linear_regression">3. 1. Simple Linear Regression</a></strong></p>
<p><strong><a class="reference external" href="#3-2-multiple-linear">3. 2. Multiple Linear Regression</a></strong></p>
<p><strong><a class="reference external" href="#4-predictive-performance">4. Predictive Performance of Linear Model</a></strong></p>
<p><strong><a class="reference external" href="#5-implementation">5. Implementation of Parametric Model: Way to Maximize House-Selling Profit for Developer</a></strong></p>
<p><strong><a class="reference external" href="#5-1-case-example">5. 1. Case Example</a></strong></p>
<p><strong><a class="reference external" href="#5-2-solution">5. 2. Solution</a></strong></p>
<p><strong><a class="reference external" href="#6-closing">6. Closing</a></strong></p>
<p><a id="1_introduction"> </a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h1>
<p>Consider this: a real-estate developer wants to kick off a new housing project. In order to deliver informed-decision so that the project performs optimally, you’ve been asked to gather some idea about current house price and analyze it and see what can we do about it.</p>
<p>Having a dataset that records house price for each specification of the house, we perform linear modeling to obtain the general idea of house price. The parametric form of linear regression gives an easier interpretation about significancy of its variables in determining the average house price. The purposefulness of this generalization will be demonstrated to solve a simple fictitious problem to maximize profit of housing project.</p>
<p><a id="about_this_notebook"> </a></p>
<section id="about-this-notebook">
<h2><strong>About this Notebook</strong><a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h2>
<p>In the first part of analysis, we will develop a simple linear model and perform some diagnostic analysis for regression to get linear model that statistically valid as possible  based on our dataset’s characteristic. Simple linear model involves only one <code class="docutils literal notranslate"><span class="pre">predictor</span> <span class="pre">variable</span></code>. The challenge of this linear regression problem is a <code class="docutils literal notranslate"><span class="pre">heteroscedastic</span></code> nature of the dataset because of particular variables. We will perform <em>heteroscedastic-robust regression</em> to overcome this problem.</p>
<p>After we discover general rules to be obeyed in working with our dataset, we will develop linear model that involves multiple <code class="docutils literal notranslate"><span class="pre">predictor</span> <span class="pre">variables</span></code>, in the hope that we will get more accurate model and identify which variables that are statistically proven to be significant in explaining relationship of Jabodetabek House Price.</p>
<p>The last part is to demonstrate the optimization process of a simple fictitious problem to maximize profit of housing project utilizing <em>Pyomo</em>, which is the <em>API</em> to instantiate <em>solver program</em> using python language. The idea is to optimize particular variables while trying to minimize production cost, given the cost of each unit of the variables and certain requirements to be met.</p>
<p><a id="2_preparing_the_dataset"> </a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="preparing-the-dataset-and-modules">
<h1>2. Preparing the Dataset and Modules<a class="headerlink" href="#preparing-the-dataset-and-modules" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">modules.custom_estimator</span> <span class="kn">import</span> <span class="n">HetRobustRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">bootstrap</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Setting pandas options</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.float&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_info_columns&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Preparing dataset</span>
<span class="c1"># Train set</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\X_train.csv&#39;</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\y_train.csv&#39;</span><span class="p">)</span>
<span class="c1"># Test set</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\X_test.csv&#39;</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\y_test.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="3_linear_modeling"> </a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="linear-modeling">
<h1>3. Linear Modeling<a class="headerlink" href="#linear-modeling" title="Permalink to this headline">#</a></h1>
<p>Regression analysis is performed to get the best explanation about the relationship between <code class="docutils literal notranslate"><span class="pre">target</span> <span class="pre">variable(s)</span></code> and the <code class="docutils literal notranslate"><span class="pre">explanatory/predictor</span> <span class="pre">variable(s)</span></code>. Relationship between house price and its specification is clearly related in a <code class="docutils literal notranslate"><span class="pre">non-deterministic</span></code> fashion, therefore the main objective is to obtain a probabilistic linear relationship and making inferences based on data obtained from the model.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">non-deterministic</span></code> fashion is explained as follows: once the value of <code class="docutils literal notranslate"><span class="pre">predictors</span></code> has been determined, there is still uncertainty in what the resulting <code class="docutils literal notranslate"><span class="pre">target</span> <span class="pre">variables</span></code> will be. In probability analysis, this <code class="docutils literal notranslate"><span class="pre">probabilistic</span></code> relationship leads the <code class="docutils literal notranslate"><span class="pre">target</span> <span class="pre">variables</span></code> as being a <code class="docutils literal notranslate"><span class="pre">random</span> <span class="pre">variables</span></code>.</p>
<p><a id="3_1_simple_linear_regression"> </a></p>
<section id="simple-linear-regression">
<h2>3.1. Simple Linear Regression<a class="headerlink" href="#simple-linear-regression" title="Permalink to this headline">#</a></h2>
<p>Let’s consider a very simple linear regression system using intercept and an explanatory variable. From previous chapter, we found that <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> has the largest linear correlation coefficient to <code class="docutils literal notranslate"><span class="pre">price_in_rp</span></code>, our target variable.</p>
<p>We first will look at the summary of our target and predictor variable:</p>
<div class="cell tag_output-scroll tag_hide-input tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">],</span> <span class="n">y_train</span><span class="p">,</span>
    <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;50%&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>min</th>
      <th>50%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>building_size_m2</th>
      <td>3,068.00</td>
      <td>186.75</td>
      <td>18.00</td>
      <td>112.00</td>
      <td>6,000.00</td>
    </tr>
    <tr>
      <th>price_in_rp</th>
      <td>3,068.00</td>
      <td>3,997,153,520.21</td>
      <td>125,000,000.00</td>
      <td>1,500,000,000.00</td>
      <td>250,000,000,000.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>According to above summary, it is necessary to acknowledge that our linear model will be <strong>representative to generalize Jabodetabek House Price with building size in interval <span class="math notranslate nohighlight">\([18\;m^2,\;6000\;m^2]\)</span></strong>. Identifying house price with building size outside that interval will subject to extrapolating hence isn’t suggested.</p>
<p>In simple regression setting, the model is explained as:</p>
<div class="math notranslate nohighlight">
\[Y=\beta_{0}+\beta_{1}\;x+\varepsilon\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[Y=house\;price,\;x=building\;size\]</div>
<p><span class="math notranslate nohighlight">\(\beta_0\)</span>, usually called <code class="docutils literal notranslate"><span class="pre">intercept</span></code>, is the value of <span class="math notranslate nohighlight">\(y\)</span> when <span class="math notranslate nohighlight">\(x=0\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\beta_1\)</span> serves as <code class="docutils literal notranslate"><span class="pre">slope</span> <span class="pre">coefficient</span></code>, which is the increase of <span class="math notranslate nohighlight">\(y\)</span> when <span class="math notranslate nohighlight">\(x\)</span> increases by 1 unit.</p>
<p>The probabilistic fashion of our linear model here is explained by the <code class="docutils literal notranslate"><span class="pre">random</span> <span class="pre">error</span></code> <span class="math notranslate nohighlight">\(\varepsilon\)</span>, with specific random distribution that generally assummed to follow a normal distribution <span class="math notranslate nohighlight">\(N(0, \sigma)\)</span>. This specified <span class="math notranslate nohighlight">\(N(0, \sigma)\)</span> determines that the <code class="docutils literal notranslate"><span class="pre">random</span> <span class="pre">error</span></code> has <span class="math notranslate nohighlight">\(mean=0\)</span> and the spread of randomness around the <code class="docutils literal notranslate"><span class="pre">regression</span> <span class="pre">line</span></code>, i.e. the variability of observations, is controlled by standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span>. The value of <span class="math notranslate nohighlight">\(\varepsilon\)</span> is also independent of <span class="math notranslate nohighlight">\(x\)</span>, or often stated as <code class="docutils literal notranslate"><span class="pre">equal</span> <span class="pre">variance</span> <span class="pre">along</span> <span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">constant</span> <span class="pre">variance</span></code>.</p>
<p>The estimation of <span class="math notranslate nohighlight">\(\beta_0\)</span> and <span class="math notranslate nohighlight">\(\beta_1\)</span> parameters in this analysis involves <code class="docutils literal notranslate"><span class="pre">Least</span> <span class="pre">Square</span> <span class="pre">Method</span></code>, which estimates value of those parameters that minimize sum of squared error between regression line and observation points.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">statsmodels.api</span> <span class="kn">import</span> <span class="n">OLS</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools</span> <span class="kn">import</span> <span class="n">add_constant</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="c1"># regression formula:</span>
<span class="c1"># price_in_rp ~ intercept + building_size_m2</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th> <td>   0.460</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.460</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   2609.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Fri, 03 Feb 2023</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>16:51:06</td>     <th>  Log-Likelihood:    </th> <td> -74037.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  3068</td>      <th>  AIC:               </th> <td>1.481e+05</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  3066</td>      <th>  BIC:               </th> <td>1.481e+05</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table></div></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>, performing linear regression is also followed by some important statistical tests, explained below:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">F-statistic</span></code> here is a statistical test of the overall significance, whether linear regression model provides a better fit to the data compared to a model that contains no <code class="docutils literal notranslate"><span class="pre">predictor</span> <span class="pre">variable</span></code> <span class="math notranslate nohighlight">\(x\)</span>, in other words, model with <code class="docutils literal notranslate"><span class="pre">only</span> <span class="pre">intercept</span></code>. In statistical term, this test the <code class="docutils literal notranslate"><span class="pre">null</span> <span class="pre">hypotheses</span></code> that the model with <code class="docutils literal notranslate"><span class="pre">intercept</span> <span class="pre">only</span></code> fits the data as well as using <code class="docutils literal notranslate"><span class="pre">linear</span> <span class="pre">model</span> <span class="pre">with</span> <span class="pre">predictor</span></code>. A large <code class="docutils literal notranslate"><span class="pre">F-statistic</span></code> (leads to low <code class="docutils literal notranslate"><span class="pre">Prob</span> <span class="pre">(F-statistic)</span></code>) reject this null hypotheses hence our <code class="docutils literal notranslate"><span class="pre">building</span> <span class="pre">size</span></code> variables is proven useful.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">R2</span></code> is called <code class="docutils literal notranslate"><span class="pre">coefficient</span> <span class="pre">of</span> <span class="pre">determination</span></code>, is the proportion of variation of <code class="docutils literal notranslate"><span class="pre">y</span></code> that can be explained by our linear model. For our model, <span class="math notranslate nohighlight">\(R^2=0.46\)</span> shows that more than half portion of variability is left unexplained.</p></li>
</ol>
<p>Let’s take a look at the value of coefficient <span class="math notranslate nohighlight">\(\beta_0\)</span> and <span class="math notranslate nohighlight">\(\beta_1\)</span>:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
          <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>            <td>-9.839e+08</td> <td> 1.64e+08</td> <td>   -5.992</td> <td> 0.000</td> <td>-1.31e+09</td> <td>-6.62e+08</td>
</tr>
<tr>
  <th>building_size_m2</th> <td> 2.667e+07</td> <td> 5.22e+05</td> <td>   51.074</td> <td> 0.000</td> <td> 2.56e+07</td> <td> 2.77e+07</td>
</tr>
</table></div></div>
</div>
<p>Inference about the linear regression coefficient has also been done here. Thit t-test is often referred as <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">Utility</span> <span class="pre">Test</span></code> for simple linear regression. The null hypotheses is that <span class="math notranslate nohighlight">\(\beta_1 = 0\)</span>.  When the <code class="docutils literal notranslate"><span class="pre">null</span> <span class="pre">hypotheses</span> <span class="pre">is</span> <span class="pre">true</span></code>, <span class="math notranslate nohighlight">\(E(Y|X) = \beta_0+0\;x\)</span>, meaning <span class="math notranslate nohighlight">\(Y\)</span> is independent of <span class="math notranslate nohighlight">\(x\)</span>, so knowledge of <span class="math notranslate nohighlight">\(x\)</span> gives no information about the value of <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>In above table, the t-statistic is rather high, so the null hypotheses is rejected at 95% confidence level. The <span class="math notranslate nohighlight">\(x\)</span> variable is associated with the value of response variable <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>Let’s take a look at <code class="docutils literal notranslate"><span class="pre">intercept</span></code> <span class="math notranslate nohighlight">\(\beta_0\)</span>. Very low negative intercept doesn’t explain anything here. Furthermore, when our explanatory variable (<code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code>) has 0 value, it has no meaning at all since it is logically false for a house with zero building size.</p>
<p>What happen if we remove the intercept will be explained below:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># regression formula</span>
<span class="c1"># price_in_rp ~ building_size_m2</span>
<span class="n">lm_1</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results_1</span> <span class="o">=</span> <span class="n">lm_1</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared (uncentered):</th>      <td>   0.529</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared (uncentered):</th> <td>   0.529</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>          <td>   3449.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Fri, 03 Feb 2023</td> <th>  Prob (F-statistic):</th>           <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>16:51:07</td>     <th>  Log-Likelihood:    </th>          <td> -74055.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  3068</td>      <th>  AIC:               </th>          <td>1.481e+05</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  3067</td>      <th>  BIC:               </th>          <td>1.481e+05</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>              <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>              <td> </td>    
</tr>
</table></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
          <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>building_size_m2</th> <td> 2.481e+07</td> <td> 4.23e+05</td> <td>   58.728</td> <td> 0.000</td> <td>  2.4e+07</td> <td> 2.56e+07</td>
</tr>
</table></div></div>
</div>
<p>The <span class="math notranslate nohighlight">\(R^2\)</span> increases. The <span class="math notranslate nohighlight">\(\beta_1\)</span> is adjusted in the absence of <code class="docutils literal notranslate"><span class="pre">intercept</span></code>. From now on, we will consider model:</p>
<div class="math notranslate nohighlight">
\[Y=\beta_{1}\;x+\varepsilon\]</div>
<p>considering OLS results, our linear model:</p>
<div class="math notranslate nohighlight">
\[Y=24,810,000\;{building\;size}+\varepsilon\]</div>
<p>where 24,810,000 serves as <em>point estimate</em> of <span class="math notranslate nohighlight">\(\beta_1\)</span>, commonly denoted as <span class="math notranslate nohighlight">\(\hat{\beta_1}\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># linear OLS</span>
<span class="n">y_predict_1</span> <span class="o">=</span> <span class="n">results_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">mse_1</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_predict_1</span><span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">building_size_m2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">building_size_m2</span><span class="p">),</span>
        <span class="n">y_predict_1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">building_size_m2</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;RMSE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Ordinary Least Square Regression of price_in_rp for building_size_m2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_21_0.png" src="_images/3 - Linear Modeling of House Price_21_0.png" />
</div>
</div>
<p>The randomness/variability of <span class="math notranslate nohighlight">\(y\)</span> along the regression line is somewhat increasing. Figure on the right side involves the same observations, but both <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> axis is <code class="docutils literal notranslate"><span class="pre">log-scaled</span></code>. That figure shows how <code class="docutils literal notranslate"><span class="pre">constant</span> <span class="pre">variance</span></code> should look like, not on what the left side shows.</p>
<p>However, figure on the right explains that linearity exists between our explanatory variable and our target variable, but don’t be deceived by its equally spreaded (constance variance) response along the regression line because the actual result is the figure on the left.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_predict_1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y_predict&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;y_obs vs y_predict&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_23_0.png" src="_images/3 - Linear Modeling of House Price_23_0.png" />
</div>
</div>
<p>Above plot shows <code class="docutils literal notranslate"><span class="pre">actual</span> <span class="pre">observations</span></code> vs <code class="docutils literal notranslate"><span class="pre">linear</span> <span class="pre">model</span> <span class="pre">prediction</span></code>. Note that the spreading observations can also be identified on the left side plot above. Linear model that somewhat has ideal characteristic should be similar with what plot on the right side shows.</p>
<p>Green line represents <span class="math notranslate nohighlight">\(x=y=y_{obs}\)</span>, exact prediction line of <span class="math notranslate nohighlight">\(y_{obs}\)</span>. Our linear model seems to <em>overestimates</em> <span class="math notranslate nohighlight">\(y\)</span> for lower house price.</p>
<p><a id="residual_analysis_simple"> </a></p>
<section id="residual-analysis-of-simple-linear-regression">
<h3><strong>Residual Analysis of Simple Linear Regression</strong><a class="headerlink" href="#residual-analysis-of-simple-linear-regression" title="Permalink to this headline">#</a></h3>
<p>Our next objective is to verify if our regression result conform with linear model concept about the normally distributed residual with constant variance. Let’s take a look at residual plot along the <span class="math notranslate nohighlight">\(x\)</span> variable:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_predict_1</span>
<span class="n">mean_resid_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">resid_1</span><span class="p">)</span>
<span class="c1"># matpltlib plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">building_size_m2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">resid_1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">resid_1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean residual = </span><span class="si">{</span><span class="n">mean_resid_1</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Residual plot, building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_27_0.png" src="_images/3 - Linear Modeling of House Price_27_0.png" />
</div>
</div>
<p>Figure on the left shows that residual is somewhat increasing in variability that associated with increasing <code class="docutils literal notranslate"><span class="pre">building</span> <span class="pre">size</span></code>. Figure on the right magnifies the <em>increasing pattern of residuals</em>, it shows positive residual on log-scaled axes.</p>
<p>Look at the mean of the residuals. It is clearly biased by almost half of billions rupiahs and violates the OLS errors assumption (zero mean).</p>
<p>How about the normality of residual’s distribution?</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.graphics.gofplots</span> <span class="kn">import</span> <span class="n">ProbPlot</span>

<span class="c1"># ditribution of residual plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">resid_1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual distribution, OLS&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2e10</span><span class="p">,</span> <span class="mf">2e10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_resid_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean Residual, </span><span class="si">{</span><span class="n">mean_resid_1</span><span class="si">:</span><span class="s1">,.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># Q-Q Plot</span>
<span class="n">pplot</span> <span class="o">=</span> <span class="n">ProbPlot</span><span class="p">(</span><span class="n">resid_1</span><span class="p">)</span>
<span class="n">pplot</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot of the Residuals&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_29_0.png" src="_images/3 - Linear Modeling of House Price_29_0.png" />
</div>
</div>
<p>Red line on the left figure is vertical line which explains <span class="math notranslate nohighlight">\(residual = 0\)</span>. The distribution is rather <em>shifted to the left</em>, and since <span class="math notranslate nohighlight">\(residual = y_{obs} - y_{predict}\)</span>, it proves that, generally, our model <strong>overestimate</strong> the actual <span class="math notranslate nohighlight">\(y\)</span>. Therefore, it can be concluded that the residual is not located at 0.</p>
<p>Figure on the right side is Q-Q plot of residual against standard normal distribution. If residual was normally distributed, the residual plots should be tightly positioned near the red line. This figure also proves that the distribution is quiet more fat-tailed than what normal distribution should.</p>
<p>Ordinary Least Square (OLS), according to Gauss-Markov Theorem, is <em>BLUE: Best Linear Unbiased Estimator</em>, when our model satisfies all of the six classical assumptions, including the <em>constant variance</em> assumption. <em>‘Best’</em> refers to minimum variance or the narrowest sampling distribution. However, our dataset suffers from non-constant variance, what is commonly called, the presence of <em>heteroscedacity</em>. From above figure, it is clearly shown that <strong>ordinary least square is a biased estimator for our dataset</strong>.</p>
<p>We will use Breusch-Pagan test for heteroscedacity using below codes. The concept of Breusch-Pagan test is to estimate the auxillary regression, that is regression of the squared residuals on the predictor variable, then calculate the test statistic based on that regression. However, due violation of normality as explained above, actually below test is the Koenker’s variant, which is robust to non-normal distribution.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">het_breuschpagan</span>

<span class="n">exog_het</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># since auxillary regression of residual </span>
<span class="c1"># must have an intercept constant:</span>
<span class="n">exog_het</span> <span class="o">=</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">exog_het</span><span class="p">)</span> 
<span class="n">lm</span><span class="p">,</span> <span class="n">lm_pvalue</span><span class="p">,</span> <span class="n">fvalue</span><span class="p">,</span> <span class="n">f_pvalue</span> <span class="o">=</span> <span class="n">het_breuschpagan</span><span class="p">(</span><span class="n">resid_1</span><span class="p">,</span> <span class="n">exog_het</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;statistic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;lagrange multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">],</span>
    <span class="s1">&#39;statistic_value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lm</span><span class="p">,</span> <span class="n">fvalue</span><span class="p">],</span>
    <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lm_pvalue</span><span class="p">,</span> <span class="n">f_pvalue</span><span class="p">]</span>
    <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>statistic</th>
      <th>statistic_value</th>
      <th>p_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>lagrange multiplier</td>
      <td>273.16</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>f</td>
      <td>299.67</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Above result <strong>rejects the null hypotheses of homoscedacity</strong>. <code class="docutils literal notranslate"><span class="pre">Weighted</span> <span class="pre">least</span> <span class="pre">square</span></code> can be a way to remedy this heteroscedacity condition.</p>
<p><a id="dealing_with_nonconstant"> </a></p>
</section>
<section id="dealing-with-non-constant-variance">
<h3><strong>Dealing with Non-Constant Variance</strong><a class="headerlink" href="#dealing-with-non-constant-variance" title="Permalink to this headline">#</a></h3>
<p>We will use <code class="docutils literal notranslate"><span class="pre">Weighted</span> <span class="pre">Least</span> <span class="pre">Square</span></code> to address non-constant variance in the data. For this dataset, we will use <code class="docutils literal notranslate"><span class="pre">Regression</span> <span class="pre">Robust</span> <span class="pre">to</span> <span class="pre">Heteroscedacity</span></code> provided in <code class="docutils literal notranslate"><span class="pre">\modules</span></code> directory, which I developed according to <span id="id1">Anthony C. Atkinsona [<a class="reference internal" href="#id14" title="Francesca Torti Anthony C. Atkinsona, Marco Riani. Robust methods for heteroskedastic regression. Computational Statistics and Data Analysis, 104:209-222, 2016.">ACA16</a>]</span>, as follows:</p>
<div class="math notranslate nohighlight">
\[Y=\beta_{i}\;x_i+\sigma_i\varepsilon_i\]</div>
<p>Errors <span class="math notranslate nohighlight">\(\varepsilon_i\)</span> have a homoscedastic standard normal distribution <span class="math notranslate nohighlight">\(N(0, 1)\)</span>. Variance function <span class="math notranslate nohighlight">\(\sigma_i\)</span> is dependent of variables responsible for heterscedascity, <span class="math notranslate nohighlight">\(Z\)</span>:</p>
<div class="math notranslate nohighlight">
\[\sigma_i = Var\;y_i=\sigma^2(1+exp(z_i\gamma))\]</div>
<p>Sample weight is estimated using above parametric formula:</p>
<div class="math notranslate nohighlight">
\[w_i=\sigma^2\;/\;\sigma_i^2=(g(z_i\gamma))^{-1}\]</div>
<p>The WLS model above explained as follows:</p>
<p>Parameters will be estimated using least square, but here we want consider the sample noise <span class="math notranslate nohighlight">\(\varepsilon_i\)</span> that is associated with <span class="math notranslate nohighlight">\(\sigma_i\)</span>, or in other words, noise terms will have large magnitudes when the variance is large.</p>
<p>OLS cares equally about the error at each data point, which we don’t favor for dataset <strong>having variance that is constantly increasing</strong> as the <span class="math notranslate nohighlight">\(x\)</span> increase. This is because the regression line will be leveraged towards the high noise observations! To account for sample noise, here each sample will be weighted: when noise variance is large, it shall has small weight (and vice versa). This is why <code class="docutils literal notranslate"><span class="pre">sample</span> <span class="pre">weight</span></code> is proporsional to the <code class="docutils literal notranslate"><span class="pre">inverse</span> <span class="pre">of</span> <span class="pre">variance</span></code>.</p>
<p>Mean square error, the cost function to be minimized, will becomes weighted for each sample as:</p>
<div class="math notranslate nohighlight">
\[WMSE(b,\;w_1,...,\;w_n) = {\frac 1 n}\;\sum_{
    \begin{subarray}{l}1\leq\;i\leq\;n\end{subarray}
}w_i(y_i-x_ib)\]</div>
<p>After the sample weight is introduced, the Least Square estimate “tries harder” to match observations with large weight, and less hard to match them where the weight are small, conforms with what we expect for sample with large noise.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">robust_reg</span> <span class="o">=</span> <span class="n">HetRobustRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Weighted LS with full dataset</span>
<span class="n">lm_2a</span> <span class="o">=</span> <span class="n">robust_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">y_predict_2a</span> <span class="o">=</span> <span class="n">robust_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">sample_weight_a</span> <span class="o">=</span> <span class="n">lm_2a</span><span class="o">.</span><span class="n">weight_</span>
<span class="n">sample_weight_a_normlzd</span> <span class="o">=</span> \
    <span class="p">(</span><span class="n">sample_weight_a</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">))</span>
<span class="n">scaled_weight_a</span> <span class="o">=</span> <span class="n">sample_weight_a_normlzd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">mse_2a</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_predict_2a</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight_a</span><span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
    <span class="n">y_predict_2a</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Weighted LS Regression</span><span class="se">\n</span><span class="s1">RMSE (weighted)= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_2a</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
    <span class="n">scaled_weight_a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sample weight&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Weighted Least Square Regression of price_in_rp for building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_35_0.png" src="_images/3 - Linear Modeling of House Price_35_0.png" />
</div>
</div>
<p>Above figure shows the <code class="docutils literal notranslate"><span class="pre">weight</span> <span class="pre">trend</span></code> in dashed line. Here we can see the weight become much smaller, associated with increases in <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code>, and become near to zero right after the data visibly starts to spread.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_predict_2a</span><span class="p">)</span>
<span class="n">mean_resid_2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">resid_2a</span><span class="p">)</span>
<span class="c1"># ditribution of residual plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">resid_2a</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual distribution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5e9</span><span class="p">,</span> <span class="mf">2.5e9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_resid_2a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean Residual, </span><span class="si">{</span><span class="n">mean_resid_2a</span><span class="si">:</span><span class="s1">,.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># Q-Q Plot</span>
<span class="n">pplot</span> <span class="o">=</span> <span class="n">ProbPlot</span><span class="p">(</span><span class="n">resid_2a</span><span class="p">)</span>
<span class="n">pplot</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot of the Residuals&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_37_0.png" src="_images/3 - Linear Modeling of House Price_37_0.png" />
</div>
</div>
<p>Residual mean drastically reduced compared to OLS model, and become closer to 0. Note that the Q-Q plot is also tighter to standard normal line.</p>
<p>Although it seems ‘unfair’ that we are using weighted residual, in section <strong>3. Predictive Performance of Linear Model</strong>, we will look at residual plot using test set.</p>
<p>In the next section, we will try to reduce the bias more by eliminating observations that possibly act as outliers in our dataset.</p>
<p><a id="outliers-detection"> </a></p>
</section>
<section id="outliers-detection-studentized-residual-leverage-point-cook-distance">
<h3><strong>Outliers Detection: Studentized Residual, Leverage Point, Cook Distance</strong><a class="headerlink" href="#outliers-detection-studentized-residual-leverage-point-cook-distance" title="Permalink to this headline">#</a></h3>
<p>Standardized form of observation residual, or commonly denoted as <strong>studentized residual</strong>, can be used to detect if an observation is an outliers. This because <em>i</em>th <em>standardized residual</em> indicates how many standard deviations away that corresponding <em>i</em>th observation <span class="math notranslate nohighlight">\(y_i\)</span> is from <em>i</em>th prediction <span class="math notranslate nohighlight">\(\hat{y_i}\)</span>.</p>
<p>By convention, the <em>i</em>th observation is said to have very large residual if <span class="math notranslate nohighlight">\(|e^*_i|&gt;3\)</span> (<span id="id2">[<a class="reference internal" href="#id15" title="Jay L. Devore. Modern Mathematical Statistics with Applications. Springer, 2021.">Dev21</a>]</span>).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">diags</span>

<span class="c1"># Cook Distance</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># no intercept</span>
<span class="n">Xw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span>
<span class="n">yw</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">Xw</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">Xw</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">H</span><span class="p">)</span> <span class="o">@</span> <span class="n">yw</span>
<span class="n">se2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">resid</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="c1"># se2 = SSE / (n - p), p = 1 since no intercept</span>
<span class="c1"># leverage is (weighted) hat matrix diagonal</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<span class="n">student_resid</span> <span class="o">=</span> <span class="n">resid</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">se2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span>
<span class="n">outlier_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">student_resid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">outlier_obs_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">outlier_obs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="c1"># Studentized Residual Plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">student_resid</span><span class="p">[</span><span class="o">~</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">student_resid</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Outliers&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">student_resid</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">student_resid</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">outlier_obs_index</span><span class="p">]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">student_resid</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;studentized residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Studentized Residual vs building_size_m2</span><span class="se">\n</span><span class="s1">RMSE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_2a</span><span class="p">)</span><span class="si">:</span><span class="s1">,.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># Observations Plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Outliers&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">outlier_obs</span><span class="p">],</span> <span class="n">outlier_obs_index</span><span class="p">]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Outliers, price_in_rp vs building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_41_0.png" src="_images/3 - Linear Modeling of House Price_41_0.png" />
</div>
</div>
<p>In form of <code class="docutils literal notranslate"><span class="pre">Hat</span> <span class="pre">Matrix</span></code>, <span class="math notranslate nohighlight">\(H\)</span>, prediction of response <span class="math notranslate nohighlight">\(\hat{y_i}\)</span> is <span class="math notranslate nohighlight">\(\hat{y}=Hy\)</span> and therefore samplewise prediction:</p>
<div class="math notranslate nohighlight">
\[\hat{y_i}=h_{1i}y_1 + ... + h_{ii}y_i+...+h_{in}y_n\]</div>
<p>The <em>i</em>th diagonal element of <span class="math notranslate nohighlight">\(H\)</span>, <span class="math notranslate nohighlight">\(h_{ii}\)</span> measures the impact of <em>i</em>th observation <span class="math notranslate nohighlight">\(y_i\)</span> on its own predicted <span class="math notranslate nohighlight">\(\hat{y_i}\)</span> value, and sometimes called the <strong>leverages</strong> to indicate its impact on the regression.</p>
<p>An observation with very high leverage will tend to pull the regression toward it to make its residual small enough, recall that it is treated equally in minimizing cost function. High leverage observations is marked with observations that has <em>abnormally high values of predictor</em>, in our dataset it is the <em>kost</em> because the building size <span class="math notranslate nohighlight">\(6000\;m^2\)</span> is far away from common house size that provided in the dataset.</p>
<p>There is a popular measure that accounts combination of <em>high-leveraged observations</em> and <em>high standardized residual</em>, it is <strong>Cook’s Distance</strong>. Below codes calculate the <code class="docutils literal notranslate"><span class="pre">cook's</span> <span class="pre">distance</span></code> of each observations and mark the high-influence observations to be ignored.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cook Distance</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># no intercept</span>
<span class="n">Xw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span>
<span class="n">yw</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_weight_a</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">Xw</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">Xw</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">H</span><span class="p">)</span> <span class="o">@</span> <span class="n">yw</span>
<span class="n">se2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">resid</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="c1"># se2 = SSE / (n - p), p = 1 since no intercept</span>
<span class="c1"># leverage is (weighted) hat matrix diagonal</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<span class="n">student_resid</span> <span class="o">=</span> <span class="n">resid</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">se2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span>
<span class="n">cooks_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">se2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span>
<span class="n">high_influence_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">cooks_dist</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">)))</span>
<span class="n">high_influence_obs_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">high_influence_obs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># High Influence Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">student_resid</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> 
    <span class="n">s</span><span class="o">=</span> <span class="n">cooks_dist</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span> <span class="o">*</span> <span class="mi">500</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">student_resid</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> 
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">cooks_dist</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">]</span> <span class="o">*</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;high influence&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lev</span><span class="p">,</span> <span class="n">stud_resid</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
    <span class="n">h</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">student_resid</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">high_influence_obs_index</span><span class="p">]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">stud_resid</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;studentized residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Leverage vs Studentized Residual&#39;</span><span class="p">)</span>
<span class="c1"># Observations Plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> 
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Outliers&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">high_influence_obs_index</span><span class="p">]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;High Influence, price_in_rp for building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 2000.0)
</pre></div>
</div>
<img alt="_images/3 - Linear Modeling of House Price_43_1.png" src="_images/3 - Linear Modeling of House Price_43_1.png" />
</div>
</div>
<p>Note that our weighted least square doesn’t identify larger <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> as high influence, since it already considered them as their weight. The estimator now focuses more closer to higher-weighted samples (i.e. small <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code>). Look at some of the index that are presented in previous <code class="docutils literal notranslate"><span class="pre">outliers</span> <span class="pre">marker</span></code> are also shown in above.</p>
<p>Now let’s finalize our model to exclude those high influence observations.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># Weighted OLS without outliers</span>
<span class="n">lm_2b</span> <span class="o">=</span> <span class="n">robust_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">])</span>
<span class="n">y_predict_2b</span> <span class="o">=</span> <span class="n">robust_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">])</span>
<span class="n">sample_weight_b</span> <span class="o">=</span> <span class="n">lm_2b</span><span class="o">.</span><span class="n">weight_</span>
<span class="n">sample_weight_b_normlzd</span> <span class="o">=</span> \
    <span class="p">(</span><span class="n">sample_weight_b</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sample_weight_b</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sample_weight_b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sample_weight_b</span><span class="p">))</span>
<span class="n">scaled_weight_b</span> <span class="o">=</span> <span class="n">sample_weight_b_normlzd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">mse_2b</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y_predict_2b</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight_b</span><span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> 
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;outliers&#39;</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
    <span class="n">y_predict_2a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Weighted LS Regression</span><span class="se">\n</span><span class="s1">RMSE (weighted)= </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_2a</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
    <span class="n">y_predict_2b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Weighted LS Regression, w/o outliers</span><span class="se">\n</span><span class="s1">RMSE (weighted) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_2b</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
    <span class="n">scaled_weight_a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sample weight&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
    <span class="n">scaled_weight_b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sample weight, w/o outliers&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Weighted Least Square Regression of price_in_rp for building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_46_0.png" src="_images/3 - Linear Modeling of House Price_46_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_predict_2b</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y_predict&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;y_obs vs y_predict&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_47_0.png" src="_images/3 - Linear Modeling of House Price_47_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_2b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_weight_b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_predict_2b</span><span class="p">)</span>
<span class="n">mean_resid_2b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">resid_2b</span><span class="p">)</span>
<span class="c1"># ditribution of residual plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">resid_2b</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual distribution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5e9</span><span class="p">,</span> <span class="mf">2.5e9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_resid_2b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean Residual, </span><span class="si">{</span><span class="n">mean_resid_2b</span><span class="si">:</span><span class="s1">,.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># Q-Q Plot</span>
<span class="n">pplot</span> <span class="o">=</span> <span class="n">ProbPlot</span><span class="p">(</span><span class="n">resid_2b</span><span class="p">)</span>
<span class="n">pplot</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot of the Residuals&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_48_0.png" src="_images/3 - Linear Modeling of House Price_48_0.png" />
</div>
</div>
<p>The result is improved, the residual becomes closer to zero mean and tighter to normality, although a bit positively skewed.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>
        <span class="n">y_predict_1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;OLS Regression</span><span class="se">\n</span><span class="s1">RMSE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_1</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span>       
        <span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
        <span class="n">y_predict_2b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Weighted LS</span><span class="se">\n</span><span class="s1">RMSE (weighted) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_2b</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="p">)</span>  
    <span class="n">ax_</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Least Square Regression of price_in_rp for building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_50_0.png" src="_images/3 - Linear Modeling of House Price_50_0.png" />
</div>
</div>
<p><a id="inference-of-building-size"> </a></p>
</section>
<section id="inference-of-building-size-m2-parameter-and-mean-response">
<h3><strong>Inference of <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> parameter  and <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">response</span></code></strong><a class="headerlink" href="#inference-of-building-size-m2-parameter-and-mean-response" title="Permalink to this headline">#</a></h3>
<p>In order to analyze the precision of our coefficient estimate, the inference will be performed by identifying its confidence interval. Quite narrow interval suggest that dataset gives the reasonable precise knowledge of the parameter.</p>
<p>Due to the presence of heteroscedacity, a regular standard error is not valid to be used. Some remedies exist, for example, using a <code class="docutils literal notranslate"><span class="pre">robust</span> <span class="pre">covariance</span> <span class="pre">matrix</span></code>, but sometimes can also be biased in the presence of observations with high leverage <span id="id3">[<a class="reference internal" href="#id16" title="Emmanuel Flachaire. Bootstrapping heteroskedastic regression models: wild bootstrap vs. pairs bootstrap. Computational Statistics and Data Analysis, 49:361-376, 2003.">Fla03</a>]</span>.</p>
<p>Also according to <span id="id4">Flachaire [<a class="reference internal" href="#id16" title="Emmanuel Flachaire. Bootstrapping heteroskedastic regression models: wild bootstrap vs. pairs bootstrap. Computational Statistics and Data Analysis, 49:361-376, 2003.">Fla03</a>]</span>, there is <code class="docutils literal notranslate"><span class="pre">wild</span> <span class="pre">bootstrap</span></code> which is proven robust to heteroscedacity hence performs better than using <code class="docutils literal notranslate"><span class="pre">robust</span> <span class="pre">covariance</span> <span class="pre">matrix</span></code>. This is because the DGP involves resampling that ‘obey’ the variance from individual residuals, explained in equation below:</p>
<div class="math notranslate nohighlight">
\[y^*_t=X_t+\tilde{u}_t\epsilon^*_t\]</div>
<p>The heteroscedacity in bootstrap DGP is controlled by <em>restricted residual</em> <span class="math notranslate nohighlight">\(\tilde{u_t}\)</span>, the only variability is from resampling white noise <span class="math notranslate nohighlight">\(\epsilon^*_t\)</span>. White noise is resampled from uniformly distributed:</p>
<div class="math notranslate nohighlight">
\[\epsilon^*_t=1\;or\;-1\]</div>
<div class="math notranslate nohighlight">
\[Pr(\epsilon^*_t=1)=Pr(\epsilon^*_t=-1)=0.5\]</div>
<p>According to <span id="id5">A.C. Davidson [<a class="reference internal" href="#id17" title="D.V. Hinkley A.C. Davidson. Bootstrap Methods and their Application. Cambride University Press, 1993.">ACD93</a>]</span>, since we introduce <em>zero intercept</em> the residual shall be mean-corrected before being used to simulate random errors.</p>
<div class="cell tag_hide-input tag_output-scroll tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">coefficient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_null</span><span class="p">,</span> <span class="n">boot_resid</span><span class="p">):</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_null</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span> <span class="c1"># Flachair&#39;s pick distribution</span>
    <span class="n">boot_resid_</span> <span class="o">=</span> <span class="n">boot_resid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">resid_dgp</span> <span class="o">=</span> <span class="n">boot_resid_</span> <span class="o">*</span> <span class="n">epsilon</span>
    <span class="n">y_dgp</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_null</span> <span class="o">+</span> <span class="n">resid_dgp</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lm_boots</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y_dgp</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">result_boots</span> <span class="o">=</span> <span class="n">lm_boots</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">coef_boots</span> <span class="o">=</span> <span class="n">result_boots</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">coef_boots</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span>
<span class="c1"># prediction</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">HetRobustRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">y_predict</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># y_predict here serves beta as the null hypotheses for bootstrap</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">coef_</span>
<span class="c1"># calculate hat matrix</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="c1">#  = h_t in Flachair (2003)</span>
<span class="c1"># calculate adjusted residual</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_predict</span> <span class="c1"># = OLS restricted residuals in Flachair (2003)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="c1"># using HC3 as proposed by Flachair (2003)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">residual</span>
<span class="n">adj_resid</span> <span class="o">=</span> <span class="n">resid</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
<span class="c1"># bootstrap</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">sample</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">)</span>
<span class="n">confidence_level</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">lower_tail</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">upper_tail</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">lower_tail</span> 
<span class="n">bootstrap_res</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span>
    <span class="n">sample</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arr</span><span class="p">:</span> <span class="n">coefficient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">,</span> <span class="n">adj_resid</span><span class="p">),</span> <span class="n">vectorized</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;percentile&#39;</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Weighted OLS, w/o outliers&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;coef&#39;</span><span class="p">:</span> <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="sa">f</span><span class="s1">&#39;ci_low (</span><span class="si">{</span><span class="n">lower_tail</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="n">bootstrap_res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="sa">f</span><span class="s1">&#39;ci_high(</span><span class="si">{</span><span class="n">upper_tail</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="n">bootstrap_res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;bootstrap_se&#39;</span><span class="p">:</span> <span class="n">bootstrap_res</span><span class="o">.</span><span class="n">standard_error</span><span class="p">}</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>coef</th>
      <th>ci_low (0.025)</th>
      <th>ci_high(0.975)</th>
      <th>bootstrap_se</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Weighted OLS, w/o outliers</td>
      <td>15,490,373.55</td>
      <td>11,072,684.66</td>
      <td>19,998,991.82</td>
      <td>2,386,529.20</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The interval doesn’t include 0, therefore in 95% confidence limit, <strong>the <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> is a statistically significant parameter of linear regression. The estimated value is Rp. 15,490,373 with margin of error less than 5,000,000.</strong></p>
<p>Compare it to interval calculated using <em>student’s t distribution</em> based on standard error of the coefficient:</p>
<div class="cell tag_output-scroll tag_hide-input tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_1</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
          <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>building_size_m2</th> <td> 2.481e+07</td> <td> 4.23e+05</td> <td>   58.728</td> <td> 0.000</td> <td>  2.4e+07</td> <td> 2.56e+07</td>
</tr>
</table></div></div>
</div>
<p>For large sample, it is known that inference of regression coefficient <em>using student’s t-distribution</em> will covers the <em>violation of normality</em> since CLT suggests convergence to normality* for large sample size, but we won’t know for sure how large of <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">sample</span></code> is large enough for our dataset. But what is known that the largeness of <code class="docutils literal notranslate"><span class="pre">n</span></code> is highly affected by dataset skewness <span id="id6">[<a class="reference internal" href="#id15" title="Jay L. Devore. Modern Mathematical Statistics with Applications. Springer, 2021.">Dev21</a>]</span>, in which our dataset suffers highly. Our model with <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> also suffers from <code class="docutils literal notranslate"><span class="pre">non-constant</span> <span class="pre">variance</span></code>, which also affect the validity of our <em>t-distribution</em>.</p>
<p>The confidence interval is quite narrow (compared to the bootstrap result). The safer choice will be the <code class="docutils literal notranslate"><span class="pre">bootstrap</span> <span class="pre">confidence</span> <span class="pre">interval</span></code> due to reasons above.</p>
<p>As we hope that the bootstrap result portrays the true distribution of coefficient onfidently (we followed wild bootstrap method to achieve unbiased regression DGP and we assume that the dataset covers the population data well enough), the possibility of <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> value can be identified by using below bootstrap plot.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span>
<span class="c1"># prediction</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">HetRobustRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">y_predict</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># y_predict here serves beta as the null hypotheses for bootstrap</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">coef_</span>
<span class="c1"># calculate hat matrix</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="c1">#  = h_t in Flachair (2003)</span>
<span class="c1"># calculate adjusted residual</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_predict</span> <span class="c1"># = OLS restricted residuals in Flachair (2003)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="c1"># using HC3 as proposed by Flachair (2003)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">residual</span>
<span class="n">adj_resid</span> <span class="o">=</span> <span class="n">resid</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
<span class="c1"># bootstrapping</span>
<span class="n">n_iter</span> <span class="o">=</span> <span class="mi">9999</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_iter</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">bootstrap_coeff_value</span> <span class="o">=</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">coefficient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">,</span> <span class="n">resid</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
<span class="c1"># plotting bootstrap result</span>
<span class="n">conf_low</span> <span class="o">=</span> <span class="n">bootstrap_res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">conf_high</span> <span class="o">=</span> <span class="n">bootstrap_res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bootstrap_coeff_value</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">conf_low</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">conf_high</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Coefficient Value Distribution, building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xticks</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;coefficient value&#39;</span><span class="p">)</span>
<span class="c1"># Q-Q Plot</span>
<span class="n">pplot</span> <span class="o">=</span> <span class="n">ProbPlot</span><span class="p">(</span><span class="n">bootstrap_coeff_value</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">pplot</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot, building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coeff value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_57_0.png" src="_images/3 - Linear Modeling of House Price_57_0.png" />
</div>
</div>
<p>Although the Q-Q plot is tight to the normality, the distribution is fat-tailed, in which the sample size effect doesn’t quite make the distribution <em>converge to normality</em> yet.</p>
<p>Both the skewed and fat-tailed distribution will be considered in <code class="docutils literal notranslate"><span class="pre">BCa</span> <span class="pre">Corrected</span> <span class="pre">Interval</span></code> that has been calculated by using <code class="docutils literal notranslate"><span class="pre">scipy.stats.bootstrap</span></code> program, making the <code class="docutils literal notranslate"><span class="pre">bootstrap</span> <span class="pre">ci</span></code> resulting in the more confidence choice of CI calculation.</p>
<p>Since our regression formula <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">15,490,373</span> <span class="pre">*</span> <span class="pre">X</span></code> here gives <code class="docutils literal notranslate"><span class="pre">conditional</span> <span class="pre">mean</span> <span class="pre">of</span> <span class="pre">price_price_in_rp</span> <span class="pre">at</span> <span class="pre">particular</span> <span class="pre">building_size_m2:</span> <span class="pre">mean</span> <span class="pre">y</span> <span class="pre">given</span> <span class="pre">X=x*</span></code>, confidence interval of X parameter will able to provide <code class="docutils literal notranslate"> <span class="pre">inference</span> <span class="pre">of</span> <span class="pre">mean</span> <span class="pre">y</span> <span class="pre">at</span> <span class="pre">95%</span> <span class="pre">confidence</span> <span class="pre">level</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">low_ci</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">*</span> <span class="n">conf_low</span><span class="p">)</span>
<span class="n">high_ci</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">*</span> <span class="n">conf_high</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">lm_2b</span><span class="o">.</span><span class="n">score</span><span class="p">(</span>
    <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
    <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span>
    <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>
        <span class="n">high_ci</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper/Lower Mean Confidence Int. Bound&#39;</span>       
    <span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>
        <span class="n">low_ci</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper/Lower Confidence Int. Bound&#39;</span>       
    <span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
        <span class="n">y_predict_2b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span>\
            <span class="s1">&#39;Weighted OLS Regression, w/o outliers&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RMSE (weighted) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse_2b</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">R2 = </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>  
    <span class="n">ax_</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Weighted Least Square Regression of price_in_rp for building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_59_0.png" src="_images/3 - Linear Modeling of House Price_59_0.png" />
</div>
</div>
<p><a id="prediction-interval-of-simple"> </a></p>
</section>
<section id="prediction-interval-of-simple-regression">
<h3><strong>Prediction Interval of Simple Regression</strong><a class="headerlink" href="#prediction-interval-of-simple-regression" title="Permalink to this headline">#</a></h3>
<p>Prediction interval of a linear regression is an interval of plausible values of future Y at a specific value of parameter x*, which accounts for <em><strong>variance of mean response Y caused by variability of regression coefficient which accounted in regression model</strong>, and <strong>variability caused by error term which can’t be explained in regression model</strong></em>.</p>
<p>Recall from previous section, our <em>R2</em> value for this model is 0.639, explains that there were variability that can’t be explained by the simple linear model. Plot of <em>Y_obs vs Y_predicted</em> also shows unexplained variance of the response by using only <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code>.</p>
<p>The error term variability can also be seen in residual plot, where the residual is quite condensed in small <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> but continue to spread out in large <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code>.</p>
<p>Theoretical prediction interval of OLS relies heavily on <em>normality assumption</em> and <em>constant variance</em> <span id="id7">[<a class="reference internal" href="#id15" title="Jay L. Devore. Modern Mathematical Statistics with Applications. Springer, 2021.">Dev21</a>]</span>, which is violated by our simple linear model.</p>
<p>Let’s see the calculated prediction interval by our Simple Linear Model, which is simply calculated by assumming the normality and constant variance is valid.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">y_predict</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">pi_lower</span> <span class="o">=</span> <span class="n">y_predict</span><span class="o">.</span><span class="n">obs_ci_lower</span>
<span class="n">pi_upper</span> <span class="o">=</span> <span class="n">y_predict</span><span class="o">.</span><span class="n">obs_ci_upper</span>
<span class="n">outside_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">pi_upper</span><span class="p">,</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">pi_lower</span><span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">outside_pi</span><span class="p">],</span> 
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">outside_pi</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">outside_pi</span><span class="p">],</span> 
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">outside_pi</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;outside pi&#39;</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_lower</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower Prediction Interval&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_upper</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper Prediction Interval&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">y1</span><span class="o">=</span><span class="n">pi_lower</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">)],</span> 
    <span class="n">y2</span><span class="o">=</span><span class="n">pi_upper</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">)],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Ordinary Least Square Regression of price_in_rp for building_size_m2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_62_0.png" src="_images/3 - Linear Modeling of House Price_62_0.png" />
</div>
</div>
<p>The variability of the response is not captured well on above standard prediction interval. If we consider the weighted model setting, figure below explains the prediction interval that accounts for the sample variability.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># prediction</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">HetRobustRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">])</span>
<span class="n">y_predict</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_sample_weight</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># no intercept</span>
<span class="n">Xw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span>
<span class="n">yw</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">Xw</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">Xw</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">H</span><span class="p">)</span> <span class="o">@</span> <span class="n">yw</span>
<span class="n">sigma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">resid</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
<span class="n">sigma2i</span> <span class="o">=</span> <span class="n">sigma2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">interval</span> <span class="o">=</span> <span class="n">norm</span><span class="p">()</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">resid_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2i</span><span class="p">)</span> <span class="o">*</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">resid_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2i</span><span class="p">)</span> <span class="o">*</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pi_lower</span> <span class="o">=</span> <span class="n">y_predict</span> <span class="o">+</span> <span class="n">resid_lower</span>
<span class="n">pi_upper</span> <span class="o">=</span> <span class="n">y_predict</span> <span class="o">+</span> <span class="n">resid_upper</span>
<span class="n">outside_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">pi_upper</span><span class="p">,</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">pi_lower</span><span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="o">~</span><span class="n">outside_pi</span><span class="p">]),</span> 
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">outside_pi</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="o">~</span><span class="n">outside_pi</span><span class="p">])],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">outside_pi</span><span class="p">]),</span> 
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">outside_pi</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">outside_pi</span><span class="p">])],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;outside pi&#39;</span>
        <span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">pi_lower</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">pi_upper</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> 
        <span class="n">y1</span><span class="o">=</span><span class="n">pi_lower</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span>
        <span class="n">y2</span><span class="o">=</span><span class="n">pi_upper</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> 
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span>
    <span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;95% Prediction Interval</span><span class="se">\n</span><span class="s1">price_in_rp for building_size_m2&#39;</span><span class="p">)</span>    
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_64_0.png" src="_images/3 - Linear Modeling of House Price_64_0.png" />
</div>
</div>
<p>The prediction limit is increasing drastically after certain <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> (around 500), suggests that there is a huge uncertainty when generalizing house price with building size larger than <span class="math notranslate nohighlight">\(500\;m^2\)</span>. Therefore, linear model that is developed using this dataset is realiable for building size <span class="math notranslate nohighlight">\(\leq\;500\;m^2\)</span>.</p>
</section>
<section id="conclusion-simple-linear-regression">
<h3><strong>Conclusion: Simple Linear Regression</strong><a class="headerlink" href="#conclusion-simple-linear-regression" title="Permalink to this headline">#</a></h3>
<p>Simple linear regression using <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> is proven to be statistically significant to generalize  Jabodetabek House Price. However, the model captures only about 60% of the variability that presents in the dataset. The variability of the dataset increases along with the increase of the building size.</p>
<p>The linear model is representative to predict average house price in Jabodetabek with building size in interval <span class="math notranslate nohighlight">\([18\;m^2,\;6000\;m^2]\)</span>. Increases of the building size by <span class="math notranslate nohighlight">\(1\;m^2\)</span> will drive the house price higher by <span class="math notranslate nohighlight">\((15,490,373)\)</span>. It should be known that, due to the variability, the model seems to give precision results only for building size no more than <span class="math notranslate nohighlight">\(500m^2\)</span>.</p>
<p><a id="3-2-multiple-linear"> </a></p>
</section>
</section>
<section id="multiple-linear-regression">
<h2>3.2. Multiple Linear Regression<a class="headerlink" href="#multiple-linear-regression" title="Permalink to this headline">#</a></h2>
<p>Multiple linear regression tries to involve more than one predictors, in the hope to increase the model coverage of variability that presents in the dataset.</p>
<p>Let’s see our base multiple regression using all of the available features. Note that we will use <code class="docutils literal notranslate"><span class="pre">covariance</span> <span class="pre">matrix</span> <span class="pre">HC3</span> <span class="pre">that</span> <span class="pre">robust</span> <span class="pre">to</span> <span class="pre">heteroscedacity</span></code> to quickly estimate robust standard error and cherry-picking the predictors that are statistically significant. Later we will use <code class="docutils literal notranslate"><span class="pre">heteroscedacity</span> <span class="pre">robust</span> <span class="pre">regression</span></code> and <code class="docutils literal notranslate"><span class="pre">wild</span> <span class="pre">bootstrap</span></code> to further improve our inference quality.</p>
<p>Recall from previous chapter, we have to exclude <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Pusat</span></code> in our analysis. Removing the predictor variable alone is not enough because the model still assume <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Pusat</span></code> as a base condition (equivalently with <code class="docutils literal notranslate"><span class="pre">Bekasi</span></code>, <code class="docutils literal notranslate"><span class="pre">Depok</span></code>, <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Timur</span></code>, <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code>) and the model will possibly be biased. We have to drop the observations as well!</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_set_transfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
<span class="n">jakpus_index</span> <span class="o">=</span> <span class="n">train_set_transfd</span><span class="p">[</span><span class="n">train_set_transfd</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="s1">&#39; Jakarta Pusat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">train_set_transfd</span> <span class="o">=</span> <span class="n">train_set_transfd</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">jakpus_index</span><span class="p">)</span>
<span class="n">numerical_features</span> <span class="o">=</span> \
    <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;price_in_rp ~ &#39;</span>\
    <span class="o">+</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - 1 + &#39;</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(certificate, Treatment(reference=3)) + &#39;</span> <span class="c1"># `SHM` as reference</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(property_condition, Treatment(reference=3)) + &#39;</span> <span class="c1"># `butuh renovasi` as reference</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(furnishing, Treatment(reference=2)) + &#39;</span>  <span class="c1"># `unfurnished` as reference</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(city, Treatment(reference=0))&#39;</span> <span class="c1"># `Bekasi` as reference</span>

<span class="n">lm</span> <span class="o">=</span> <span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_set_transfd</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HC3&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What have we done using above codes?</p>
<ol class="simple">
<li><p>We treat category variable using (k - 1) one-hot encoder, treating a value in a category as a reference. For example, <code class="docutils literal notranslate"><span class="pre">Bekasi</span></code> is a base reference for <code class="docutils literal notranslate"><span class="pre">city</span></code> predictor after it is encoded. Then, for example, the coefficient of encoded <code class="docutils literal notranslate"><span class="pre">Tangerang</span></code> is interpreted as <strong>increase of mean response if <code class="docutils literal notranslate"><span class="pre">city</span></code> is <code class="docutils literal notranslate"><span class="pre">Tangerang</span></code> instead of <code class="docutils literal notranslate"><span class="pre">Bekasi</span></code></strong>.</p></li>
<li><p>Covariance type is set to <code class="docutils literal notranslate"><span class="pre">HC3</span></code>, set the OLS regression to consider robust covariance matrix. This is to ensure that we use the proper method of determining t-statistics for our parameter estimate. According to <span id="id8">Flachaire [<a class="reference internal" href="#id16" title="Emmanuel Flachaire. Bootstrapping heteroskedastic regression models: wild bootstrap vs. pairs bootstrap. Computational Statistics and Data Analysis, 49:361-376, 2003.">Fla03</a>]</span>, <code class="docutils literal notranslate"><span class="pre">HC3</span></code> performs better in finite sample and superior than any other in typical cases.</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">train_set_transfd</span><span class="p">[</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_set_transfd</span><span class="p">)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">train_set_transfd</span><span class="o">.</span><span class="n">price_in_rp</span> <span class="o">-</span> <span class="n">y_hat</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
<span class="c1"># matpltlib plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">resid</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">resid</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Residual plot of multiple regression</span><span class="se">\n</span><span class="s1">RMSE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">resid</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">resid</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y_hat&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_72_0.png" src="_images/3 - Linear Modeling of House Price_72_0.png" />
</div>
</div>
<p>The presence of heteroscedacity can also be identified, because as shown in simple linear model the <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> (and possibly <code class="docutils literal notranslate"><span class="pre">land_size_m2</span></code> which has similar characteristics) is responsible to heteroscedacity.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>price_in_rp</td>   <th>  R-squared:         </th> <td>   0.584</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.576</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>     nan</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 31 Jan 2023</td> <th>  Prob (F-statistic):</th>  <td>   nan</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>13:14:25</td>     <th>  Log-Likelihood:    </th> <td> -72824.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  3040</td>      <th>  AIC:               </th> <td>1.458e+05</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  2980</td>      <th>  BIC:               </th> <td>1.461e+05</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>    59</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>         <td>HC3</td>       <th>                     </th>     <td> </td>    
</tr>
</table></div></div>
</div>
<p>For multiple regression, it is best to use <code class="docutils literal notranslate"><span class="pre">adjusted</span> <span class="pre">R-squared</span></code>, because regular <span class="math notranslate nohighlight">\(R^2\)</span> tends to be inflated by involvement of many predictor variables <span id="id9">[<a class="reference internal" href="#id15" title="Jay L. Devore. Modern Mathematical Statistics with Applications. Springer, 2021.">Dev21</a>]</span>. The <span class="math notranslate nohighlight">\(R^2\)</span> is inferior compared to our simple WLS model possibly because so many predictors are involved and most of them are statistically insignificant.</p>
<p><a id="multicollinearity"> </a></p>
<section id="multicollinearity">
<h3><strong>Multicollinearity</strong><a class="headerlink" href="#multicollinearity" title="Permalink to this headline">#</a></h3>
<p>Collinearity between predictor variables can mask the importance of a variable that is collinear with such. In multiple regression setting with high degree of predictor variables, it is also possible for collinearity to exist between three or more variables even if no pair of variables has a particularly high correlation, which is called <em>multicollinearity</em>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">VIF</span></code> (variance inflation factor) is known to be a better way to assess mulicollinearity. The VIF is the ratio of the variance of <span class="math notranslate nohighlight">\(\hat{\beta_j}\)</span> when fitting the full model divided by the variance of <span class="math notranslate nohighlight">\(\hat{\beta_j}\)</span> if fit on its own. The smallest possible value for VIF is 1, which indicates the complete absence of collinearity. VIF value that exceeds 5 or 10 indicates a problematic amount of collinearity <span id="id10">[<a class="reference internal" href="#id18" title="Gareth James et. al. An Introduction to Statistical Learning. Springer, 2021.">etal21</a>]</span>.</p>
<div class="cell tag_hide-input tag_output-scroll tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="c1"># We need to encode categorical variable first</span>
<span class="n">dummy_reference</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;city_ Bekasi&#39;</span><span class="p">,</span> <span class="s1">&#39;furnishing_unfurnished&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;property_condition_butuh renovasi&#39;</span><span class="p">,</span> <span class="s1">&#39;certificate_shm - sertifikat hak milik&#39;</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">jakpus_index</span><span class="p">)</span>
<span class="n">X_train_encoded</span> <span class="o">=</span> \
    <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">categorical_features</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dummy_reference</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;vif&#39;</span><span class="p">:</span> 
        <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X_train_encoded</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_train_encoded</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_train_encoded</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;vif&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\anaconda3\envs\general_ds\lib\site-packages\statsmodels\stats\outliers_influence.py:195: RuntimeWarning: divide by zero encountered in double_scalars
  vif = 1. / (1. - r_squared_i)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fac_gudang</th>
      <th>fac_basement</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>floors</th>
      <th>fac_keamanan</th>
      <th>property_condition_bagus</th>
      <th>fac_garden</th>
      <th>property_condition_baru</th>
      <th>building_size_m2</th>
      <th>maid_bedrooms</th>
      <th>maid_bathrooms</th>
      <th>electricity_num</th>
      <th>fac_jogging_track</th>
      <th>carports</th>
      <th>city_ Tangerang</th>
      <th>garages</th>
      <th>fac_ac</th>
      <th>city_ Bogor</th>
      <th>property_condition_bagus sekali</th>
      <th>fac_service_area</th>
      <th>fac_lapangan_bulu_tangkis</th>
      <th>fac_wastafel</th>
      <th>fac_one_gate_system</th>
      <th>fac_lapangan_voli</th>
      <th>fac_tempat_jemuran</th>
      <th>fac_lapangan_basket</th>
      <th>fac_playground</th>
      <th>fac_kulkas</th>
      <th>fac_cctv</th>
      <th>fac_masjid</th>
      <th>fac_jalur_telepon</th>
      <th>fac_lapangan_tenis</th>
      <th>fac_water_heater</th>
      <th>fac_kitchen_set</th>
      <th>land_size_m2</th>
      <th>fac_mesin_cuci</th>
      <th>fac_kolam_renang</th>
      <th>city_ Depok</th>
      <th>fac_garasi</th>
      <th>fac_tempat_gym</th>
      <th>furnishing_semi furnished</th>
      <th>fac_akses_parkir</th>
      <th>city_ Jakarta Selatan</th>
      <th>fac_lapangan_bola</th>
      <th>property_condition_sudah renovasi</th>
      <th>fac_smart_home</th>
      <th>fac_backyard_luas</th>
      <th>fac_plumbing_system</th>
      <th>city_ Jakarta Barat</th>
      <th>city_ Jakarta Utara</th>
      <th>furnishing_furnished</th>
      <th>certificate_lainnya (ppjb,girik,adat,dll)</th>
      <th>city_ Jakarta Timur</th>
      <th>certificate_hgb - hak guna bangunan</th>
      <th>fac_kolam_ikan</th>
      <th>fac_canopy</th>
      <th>fac_balkon</th>
      <th>fac_clubhouse</th>
      <th>certificate_hp - hak pakai</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>vif</th>
      <td>inf</td>
      <td>inf</td>
      <td>26.09</td>
      <td>22.69</td>
      <td>12.42</td>
      <td>10.13</td>
      <td>9.65</td>
      <td>9.44</td>
      <td>8.18</td>
      <td>5.59</td>
      <td>4.05</td>
      <td>4.03</td>
      <td>3.75</td>
      <td>3.11</td>
      <td>2.93</td>
      <td>2.93</td>
      <td>2.80</td>
      <td>2.78</td>
      <td>2.68</td>
      <td>2.65</td>
      <td>2.63</td>
      <td>2.63</td>
      <td>2.58</td>
      <td>2.52</td>
      <td>2.51</td>
      <td>2.50</td>
      <td>2.38</td>
      <td>2.28</td>
      <td>2.27</td>
      <td>2.26</td>
      <td>2.25</td>
      <td>2.24</td>
      <td>2.21</td>
      <td>2.18</td>
      <td>2.17</td>
      <td>2.16</td>
      <td>2.15</td>
      <td>2.13</td>
      <td>2.07</td>
      <td>2.03</td>
      <td>2.03</td>
      <td>2.00</td>
      <td>1.99</td>
      <td>1.87</td>
      <td>1.85</td>
      <td>1.81</td>
      <td>1.76</td>
      <td>1.58</td>
      <td>1.56</td>
      <td>1.54</td>
      <td>1.52</td>
      <td>1.33</td>
      <td>1.26</td>
      <td>1.19</td>
      <td>1.16</td>
      <td>1.16</td>
      <td>1.11</td>
      <td>1.01</td>
      <td>1.01</td>
      <td>1.01</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Infinite value of VIF shows a perfect correlation between two independent variables. Infinite value of VIF in above table involves <code class="docutils literal notranslate"><span class="pre">facilities</span></code> variable, specifically they have small amount of observations compared to 0 records of those facilities hence inflated the VIF. We will drop those variables accordingly.</p>
<p>It is common to re-calculate the VIF until the result is satisfied.</p>
<div class="cell tag_hide-input tag_output-scroll tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">high_vif_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_basement&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_gudang&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span>
    <span class="s1">&#39;floors&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_keamanan&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_garden&#39;</span><span class="p">,</span> 
    <span class="p">]</span>
<span class="n">dummy_reference</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;city_ Bekasi&#39;</span><span class="p">,</span> <span class="s1">&#39;furnishing_unfurnished&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;property_condition_butuh renovasi&#39;</span><span class="p">,</span> <span class="s1">&#39;certificate_shm - sertifikat hak milik&#39;</span><span class="p">]</span>
<span class="n">X_train_encoded</span> <span class="o">=</span> \
    <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">categorical_features</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dummy_reference</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_vif_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;vif&#39;</span><span class="p">:</span> 
        <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X_train_encoded</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_train_encoded</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_train_encoded</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;vif&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>building_size_m2</th>
      <th>property_condition_bagus</th>
      <th>property_condition_baru</th>
      <th>maid_bedrooms</th>
      <th>maid_bathrooms</th>
      <th>electricity_num</th>
      <th>fac_jogging_track</th>
      <th>carports</th>
      <th>fac_ac</th>
      <th>city_ Tangerang</th>
      <th>fac_lapangan_bulu_tangkis</th>
      <th>fac_wastafel</th>
      <th>city_ Bogor</th>
      <th>fac_one_gate_system</th>
      <th>fac_lapangan_voli</th>
      <th>fac_tempat_jemuran</th>
      <th>fac_lapangan_basket</th>
      <th>fac_playground</th>
      <th>fac_kulkas</th>
      <th>fac_cctv</th>
      <th>fac_jalur_telepon</th>
      <th>fac_lapangan_tenis</th>
      <th>fac_masjid</th>
      <th>garages</th>
      <th>fac_water_heater</th>
      <th>fac_kitchen_set</th>
      <th>fac_mesin_cuci</th>
      <th>fac_kolam_renang</th>
      <th>land_size_m2</th>
      <th>fac_tempat_gym</th>
      <th>furnishing_semi furnished</th>
      <th>fac_akses_parkir</th>
      <th>city_ Depok</th>
      <th>property_condition_bagus sekali</th>
      <th>fac_lapangan_bola</th>
      <th>city_ Jakarta Selatan</th>
      <th>fac_smart_home</th>
      <th>fac_service_area</th>
      <th>fac_backyard_luas</th>
      <th>city_ Jakarta Utara</th>
      <th>city_ Jakarta Barat</th>
      <th>fac_plumbing_system</th>
      <th>fac_garasi</th>
      <th>property_condition_sudah renovasi</th>
      <th>furnishing_furnished</th>
      <th>certificate_lainnya (ppjb,girik,adat,dll)</th>
      <th>city_ Jakarta Timur</th>
      <th>certificate_hgb - hak guna bangunan</th>
      <th>fac_kolam_ikan</th>
      <th>fac_canopy</th>
      <th>fac_balkon</th>
      <th>fac_clubhouse</th>
      <th>certificate_hp - hak pakai</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>vif</th>
      <td>4.83</td>
      <td>4.23</td>
      <td>4.18</td>
      <td>4.00</td>
      <td>3.99</td>
      <td>3.68</td>
      <td>2.95</td>
      <td>2.87</td>
      <td>2.77</td>
      <td>2.72</td>
      <td>2.63</td>
      <td>2.57</td>
      <td>2.53</td>
      <td>2.51</td>
      <td>2.51</td>
      <td>2.48</td>
      <td>2.37</td>
      <td>2.27</td>
      <td>2.26</td>
      <td>2.24</td>
      <td>2.24</td>
      <td>2.20</td>
      <td>2.19</td>
      <td>2.18</td>
      <td>2.18</td>
      <td>2.16</td>
      <td>2.15</td>
      <td>2.11</td>
      <td>2.11</td>
      <td>2.02</td>
      <td>1.99</td>
      <td>1.98</td>
      <td>1.96</td>
      <td>1.88</td>
      <td>1.85</td>
      <td>1.83</td>
      <td>1.73</td>
      <td>1.59</td>
      <td>1.57</td>
      <td>1.47</td>
      <td>1.43</td>
      <td>1.41</td>
      <td>1.41</td>
      <td>1.31</td>
      <td>1.30</td>
      <td>1.24</td>
      <td>1.17</td>
      <td>1.16</td>
      <td>1.15</td>
      <td>1.09</td>
      <td>1.01</td>
      <td>1.01</td>
      <td>1.01</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Based on our dataset, <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> is highly correlated to <code class="docutils literal notranslate"><span class="pre">land_size_m2</span></code>. The model that involves only one of those variables is possibly as good as involving both variables. But if we use both, we may get a better result if there is an observation which has a significantly larger <code class="docutils literal notranslate"><span class="pre">land_size_m2</span></code> than <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> (house located in rural area possibly has this situation), which is rarely found in our fitted dataset.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">high_vif_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_basement&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_gudang&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span>
    <span class="s1">&#39;floors&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_keamanan&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_garden&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span>
<span class="p">]</span>
<span class="n">numerical_features</span> <span class="o">=</span> \
    <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_vif_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;price_in_rp ~ &#39;</span>\
    <span class="o">+</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - 1 + &#39;</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(certificate, Treatment(reference=3)) + &#39;</span> <span class="c1"># `SHM` as reference</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(property_condition, Treatment(reference=3)) + &#39;</span> <span class="c1"># `butuh renovasi` as reference</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(furnishing, Treatment(reference=2)) + &#39;</span>  <span class="c1"># `unfurnished` as reference</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(city, Treatment(reference=0))&#39;</span> <span class="c1"># `Bekasi` as reference</span>

<span class="n">lm</span> <span class="o">=</span> <span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_set_transfd</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HC3&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="features-significancy"> </a></p>
</section>
<section id="features-significancy">
<h3><strong>Features Significancy</strong><a class="headerlink" href="#features-significancy" title="Permalink to this headline">#</a></h3>
<p>We will use predictors that only have small <em>p-value</em> i.e. are statistically significant.</p>
<div class="cell tag_hide-input tag_output-scroll tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
                                    <td></td>                                       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>C(certificate, Treatment(reference=3))[hgb - hak guna bangunan]</th>       <td> -3.82e+08</td> <td> 2.38e+09</td> <td>   -0.160</td> <td> 0.873</td> <td>-5.05e+09</td> <td> 4.29e+09</td>
</tr>
<tr>
  <th>C(certificate, Treatment(reference=3))[hp - hak pakai]</th>                <td> 1.246e+09</td> <td> 2.44e+09</td> <td>    0.510</td> <td> 0.610</td> <td>-3.54e+09</td> <td> 6.03e+09</td>
</tr>
<tr>
  <th>C(certificate, Treatment(reference=3))[lainnya (ppjb,girik,adat,dll)]</th> <td> 1.197e+08</td> <td> 2.28e+09</td> <td>    0.052</td> <td> 0.958</td> <td>-4.35e+09</td> <td> 4.59e+09</td>
</tr>
<tr>
  <th>C(certificate, Treatment(reference=3))[shm - sertifikat hak milik]</th>    <td>  1.53e+08</td> <td>  2.3e+09</td> <td>    0.066</td> <td> 0.947</td> <td>-4.36e+09</td> <td> 4.66e+09</td>
</tr>
<tr>
  <th>C(property_condition, Treatment(reference=3))[T.bagus]</th>                <td>-2.244e+09</td> <td> 2.26e+09</td> <td>   -0.994</td> <td> 0.320</td> <td>-6.67e+09</td> <td> 2.18e+09</td>
</tr>
<tr>
  <th>C(property_condition, Treatment(reference=3))[T.bagus sekali]</th>         <td>-3.257e+09</td> <td> 2.32e+09</td> <td>   -1.402</td> <td> 0.161</td> <td>-7.81e+09</td> <td>  1.3e+09</td>
</tr>
<tr>
  <th>C(property_condition, Treatment(reference=3))[T.baru]</th>                 <td>-1.774e+09</td> <td> 2.26e+09</td> <td>   -0.784</td> <td> 0.433</td> <td>-6.21e+09</td> <td> 2.66e+09</td>
</tr>
<tr>
  <th>C(property_condition, Treatment(reference=3))[T.sudah renovasi]</th>       <td>-2.877e+09</td> <td> 2.27e+09</td> <td>   -1.270</td> <td> 0.204</td> <td>-7.32e+09</td> <td> 1.56e+09</td>
</tr>
<tr>
  <th>C(furnishing, Treatment(reference=2))[T.furnished]</th>                    <td> -1.17e+09</td> <td> 6.28e+08</td> <td>   -1.864</td> <td> 0.062</td> <td> -2.4e+09</td> <td>    6e+07</td>
</tr>
<tr>
  <th>C(furnishing, Treatment(reference=2))[T.semi furnished]</th>               <td> -5.87e+08</td> <td> 4.21e+08</td> <td>   -1.395</td> <td> 0.163</td> <td>-1.41e+09</td> <td> 2.38e+08</td>
</tr>
<tr>
  <th>C(city, Treatment(reference=0))[T. Bogor]</th>                             <td>-2.688e+08</td> <td> 3.55e+08</td> <td>   -0.758</td> <td> 0.448</td> <td>-9.64e+08</td> <td> 4.26e+08</td>
</tr>
<tr>
  <th>C(city, Treatment(reference=0))[T. Depok]</th>                             <td> 5.839e+08</td> <td> 2.52e+08</td> <td>    2.313</td> <td> 0.021</td> <td> 8.91e+07</td> <td> 1.08e+09</td>
</tr>
<tr>
  <th>C(city, Treatment(reference=0))[T. Jakarta Barat]</th>                     <td>-4.148e+07</td> <td> 8.02e+08</td> <td>   -0.052</td> <td> 0.959</td> <td>-1.61e+09</td> <td> 1.53e+09</td>
</tr>
<tr>
  <th>C(city, Treatment(reference=0))[T. Jakarta Selatan]</th>                   <td> 4.576e+09</td> <td> 9.66e+08</td> <td>    4.739</td> <td> 0.000</td> <td> 2.68e+09</td> <td> 6.47e+09</td>
</tr>
<tr>
  <th>C(city, Treatment(reference=0))[T. Jakarta Timur]</th>                     <td> 2.169e+08</td> <td> 2.76e+08</td> <td>    0.787</td> <td> 0.431</td> <td>-3.23e+08</td> <td> 7.57e+08</td>
</tr>
<tr>
  <th>C(city, Treatment(reference=0))[T. Jakarta Utara]</th>                     <td> 1.365e+09</td> <td> 1.49e+09</td> <td>    0.916</td> <td> 0.360</td> <td>-1.55e+09</td> <td> 4.28e+09</td>
</tr>
<tr>
  <th>C(city, Treatment(reference=0))[T. Tangerang]</th>                         <td> 1.402e+08</td> <td> 2.97e+08</td> <td>    0.473</td> <td> 0.637</td> <td>-4.41e+08</td> <td> 7.22e+08</td>
</tr>
<tr>
  <th>land_size_m2</th>                                                          <td> 4.533e+06</td> <td> 2.44e+06</td> <td>    1.859</td> <td> 0.063</td> <td>-2.47e+05</td> <td> 9.31e+06</td>
</tr>
<tr>
  <th>building_size_m2</th>                                                      <td> 1.836e+07</td> <td> 3.93e+06</td> <td>    4.670</td> <td> 0.000</td> <td> 1.07e+07</td> <td> 2.61e+07</td>
</tr>
<tr>
  <th>carports</th>                                                              <td>-2.952e+08</td> <td> 4.77e+08</td> <td>   -0.620</td> <td> 0.536</td> <td>-1.23e+09</td> <td> 6.39e+08</td>
</tr>
<tr>
  <th>maid_bedrooms</th>                                                         <td> 3.169e+08</td> <td> 3.87e+08</td> <td>    0.819</td> <td> 0.413</td> <td>-4.41e+08</td> <td> 1.08e+09</td>
</tr>
<tr>
  <th>maid_bathrooms</th>                                                        <td> 1.098e+09</td> <td> 7.55e+08</td> <td>    1.454</td> <td> 0.146</td> <td>-3.82e+08</td> <td> 2.58e+09</td>
</tr>
<tr>
  <th>garages</th>                                                               <td>-6.655e+08</td> <td> 6.25e+08</td> <td>   -1.065</td> <td> 0.287</td> <td>-1.89e+09</td> <td> 5.59e+08</td>
</tr>
<tr>
  <th>electricity_num</th>                                                       <td> 4.376e+05</td> <td> 2.27e+05</td> <td>    1.931</td> <td> 0.053</td> <td>-6509.836</td> <td> 8.82e+05</td>
</tr>
<tr>
  <th>fac_tempat_jemuran</th>                                                    <td>  4.04e+08</td> <td> 5.01e+08</td> <td>    0.807</td> <td> 0.420</td> <td>-5.77e+08</td> <td> 1.39e+09</td>
</tr>
<tr>
  <th>fac_jalur_telepon</th>                                                     <td>-6.158e+08</td> <td> 3.78e+08</td> <td>   -1.629</td> <td> 0.103</td> <td>-1.36e+09</td> <td> 1.25e+08</td>
</tr>
<tr>
  <th>fac_jogging_track</th>                                                     <td> 5.065e+08</td> <td> 5.71e+08</td> <td>    0.887</td> <td> 0.375</td> <td>-6.13e+08</td> <td> 1.63e+09</td>
</tr>
<tr>
  <th>fac_kolam_renang</th>                                                      <td> 7.653e+08</td> <td> 3.14e+08</td> <td>    2.439</td> <td> 0.015</td> <td>  1.5e+08</td> <td> 1.38e+09</td>
</tr>
<tr>
  <th>fac_masjid</th>                                                            <td>-3.398e+08</td> <td> 2.62e+08</td> <td>   -1.298</td> <td> 0.194</td> <td>-8.53e+08</td> <td> 1.73e+08</td>
</tr>
<tr>
  <th>fac_cctv</th>                                                              <td>  4.87e+08</td> <td> 2.84e+08</td> <td>    1.713</td> <td> 0.087</td> <td>-7.03e+07</td> <td> 1.04e+09</td>
</tr>
<tr>
  <th>fac_kitchen_set</th>                                                       <td> 1.471e+08</td> <td> 6.22e+08</td> <td>    0.237</td> <td> 0.813</td> <td>-1.07e+09</td> <td> 1.37e+09</td>
</tr>
<tr>
  <th>fac_one_gate_system</th>                                                   <td>-1.102e+09</td> <td> 7.15e+08</td> <td>   -1.543</td> <td> 0.123</td> <td> -2.5e+09</td> <td> 2.98e+08</td>
</tr>
<tr>
  <th>fac_akses_parkir</th>                                                      <td> 9.459e+08</td> <td> 8.63e+08</td> <td>    1.096</td> <td> 0.273</td> <td>-7.46e+08</td> <td> 2.64e+09</td>
</tr>
<tr>
  <th>fac_playground</th>                                                        <td> 1.491e+07</td> <td> 6.82e+08</td> <td>    0.022</td> <td> 0.983</td> <td>-1.32e+09</td> <td> 1.35e+09</td>
</tr>
<tr>
  <th>fac_wastafel</th>                                                          <td>-1.042e+08</td> <td> 4.48e+08</td> <td>   -0.233</td> <td> 0.816</td> <td>-9.82e+08</td> <td> 7.74e+08</td>
</tr>
<tr>
  <th>fac_ac</th>                                                                <td>-1.273e+08</td> <td> 2.66e+08</td> <td>   -0.479</td> <td> 0.632</td> <td>-6.48e+08</td> <td> 3.94e+08</td>
</tr>
<tr>
  <th>fac_lapangan_basket</th>                                                   <td> 1.434e+09</td> <td> 1.29e+09</td> <td>    1.113</td> <td> 0.266</td> <td>-1.09e+09</td> <td> 3.96e+09</td>
</tr>
<tr>
  <th>fac_tempat_gym</th>                                                        <td>-1.501e+09</td> <td> 1.16e+09</td> <td>   -1.295</td> <td> 0.195</td> <td>-3.77e+09</td> <td>  7.7e+08</td>
</tr>
<tr>
  <th>fac_kolam_ikan</th>                                                        <td>-1.979e+09</td> <td> 1.45e+09</td> <td>   -1.365</td> <td> 0.172</td> <td>-4.82e+09</td> <td> 8.62e+08</td>
</tr>
<tr>
  <th>fac_lapangan_voli</th>                                                     <td> -2.21e+09</td> <td> 1.47e+09</td> <td>   -1.507</td> <td> 0.132</td> <td>-5.08e+09</td> <td> 6.64e+08</td>
</tr>
<tr>
  <th>fac_lapangan_tenis</th>                                                    <td> 1.781e+09</td> <td> 1.86e+09</td> <td>    0.959</td> <td> 0.338</td> <td>-1.86e+09</td> <td> 5.42e+09</td>
</tr>
<tr>
  <th>fac_lapangan_bola</th>                                                     <td>-6.612e+08</td> <td> 5.94e+08</td> <td>   -1.113</td> <td> 0.266</td> <td>-1.83e+09</td> <td> 5.04e+08</td>
</tr>
<tr>
  <th>fac_mesin_cuci</th>                                                        <td> 1.139e+09</td> <td> 1.79e+09</td> <td>    0.636</td> <td> 0.525</td> <td>-2.37e+09</td> <td> 4.65e+09</td>
</tr>
<tr>
  <th>fac_lapangan_bulu_tangkis</th>                                             <td> 6.053e+08</td> <td> 1.16e+09</td> <td>    0.521</td> <td> 0.602</td> <td>-1.67e+09</td> <td> 2.88e+09</td>
</tr>
<tr>
  <th>fac_kulkas</th>                                                            <td> 9.486e+08</td> <td> 8.86e+08</td> <td>    1.070</td> <td> 0.285</td> <td>-7.89e+08</td> <td> 2.69e+09</td>
</tr>
<tr>
  <th>fac_water_heater</th>                                                      <td>-7.335e+08</td> <td> 9.27e+08</td> <td>   -0.792</td> <td> 0.429</td> <td>-2.55e+09</td> <td> 1.08e+09</td>
</tr>
<tr>
  <th>fac_canopy</th>                                                            <td> 2.236e+08</td> <td> 1.01e+09</td> <td>    0.220</td> <td> 0.826</td> <td>-1.76e+09</td> <td> 2.21e+09</td>
</tr>
<tr>
  <th>fac_smart_home</th>                                                        <td>-7.123e+08</td> <td> 1.94e+09</td> <td>   -0.367</td> <td> 0.713</td> <td>-4.51e+09</td> <td> 3.09e+09</td>
</tr>
<tr>
  <th>fac_backyard_luas</th>                                                     <td> 1.121e+09</td> <td> 1.84e+11</td> <td>    0.006</td> <td> 0.995</td> <td>-3.59e+11</td> <td> 3.62e+11</td>
</tr>
<tr>
  <th>fac_garasi</th>                                                            <td>-1.503e+09</td> <td> 5.69e+09</td> <td>   -0.264</td> <td> 0.792</td> <td>-1.27e+10</td> <td> 9.65e+09</td>
</tr>
<tr>
  <th>fac_balkon</th>                                                            <td> 8.109e+08</td> <td> 1.71e+09</td> <td>    0.474</td> <td> 0.635</td> <td>-2.54e+09</td> <td> 4.16e+09</td>
</tr>
<tr>
  <th>fac_clubhouse</th>                                                         <td>-8.995e+08</td> <td> 2.42e+09</td> <td>   -0.371</td> <td> 0.710</td> <td>-5.65e+09</td> <td> 3.85e+09</td>
</tr>
<tr>
  <th>fac_service_area</th>                                                      <td>-1.766e+08</td> <td> 5.76e+09</td> <td>   -0.031</td> <td> 0.976</td> <td>-1.15e+10</td> <td> 1.11e+10</td>
</tr>
<tr>
  <th>fac_plumbing_system</th>                                                   <td>-6.957e+08</td> <td> 1.61e+09</td> <td>   -0.432</td> <td> 0.666</td> <td>-3.85e+09</td> <td> 2.46e+09</td>
</tr>
</table></div></div>
</div>
<p>Let’s observe above output:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Certificate</span></code> features has a high p-value, meaning that there is no significance evidence that <code class="docutils literal notranslate"><span class="pre">price_in_rp</span></code> will be associated with different type of certificate. It is also identified for <code class="docutils literal notranslate"><span class="pre">property_condition</span></code> and <code class="docutils literal notranslate"><span class="pre">furnishing</span></code> parameter. This proves our point in previous chapter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maid_bedrooms</span></code> has a low p-value but gives a high coefficient value since it is inflated by observations with high <code class="docutils literal notranslate"><span class="pre">price_in_rp</span></code> (larger house tends to provide maid_bedrooms). While this condition is proven by our data, however it is less essential to be our main parameter for generalization since it is biased only for large house so I just drop this features.</p></li>
<li><p>We expect positive values for <code class="docutils literal notranslate"><span class="pre">facilities</span></code> parameters. However some of them has negative value, means that they only <code class="docutils literal notranslate"><span class="pre">adjusting</span></code> for other parameters since it is lacking of coverage along overall price range. This will reduce our generalization so I will drop those parameters. For <code class="docutils literal notranslate"><span class="pre">positive</span> <span class="pre">coefficient</span> <span class="pre">value</span></code> of other facilities : [<code class="docutils literal notranslate"><span class="pre">fac_kolam_renang</span></code>, <code class="docutils literal notranslate"><span class="pre">fac_akses_parkir</span></code>, <code class="docutils literal notranslate"><span class="pre">fac_canopy</span></code>], we will keep that and let’s see how they will be adjusted after other coefficient primary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code> has a significantly high coefficient value, but its p-value is also high. Recall from previous chapter, <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code> is among the highest median of all DKI Jakarta and has a narrow confidence interval (unlike <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Pusat</span></code> which has large spread!). We will keep this feature first and let’s see how this feature change if we adjust other features</p></li>
<li><p>For other features that has high pvalue will be dropped.</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrices</span>

<span class="n">high_pvalue_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_tempat_jemuran&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jalur_telepon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_masjid&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_cctv&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kitchen_set&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_playground&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_wastafel&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_ac&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bola&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_mesin_cuci&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bulu_tangkis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kulkas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_water_heater&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_smart_home&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_backyard_luas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_garasi&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_balkon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_clubhouse&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_service_area&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_plumbing_system&#39;</span><span class="p">,</span>
    <span class="s1">&#39;maid_bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;maid_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;electricity_num&#39;</span>
<span class="p">]</span>
<span class="n">noise_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_one_gate_system&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_tempat_gym&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kolam_ikan&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_voli&#39;</span><span class="p">,</span> <span class="s1">&#39;carports&#39;</span><span class="p">,</span> <span class="s1">&#39;garages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fac_lapangan_basket&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_tenis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_akses_parkir&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_canopy&#39;</span>
<span class="p">]</span>
<span class="n">numerical_features</span> <span class="o">=</span> \
    <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_vif_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_pvalue_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">noise_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;price_in_rp ~ &#39;</span> <span class="o">+</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - 1 + &#39;</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(city)&#39;</span>
<span class="n">y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">train_set_transfd</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># `Bekasi` as reference</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HC3&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
              <td></td>                 <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>C(city)[ Bogor]</th>           <td> -2.08e+09</td> <td> 6.62e+08</td> <td>   -3.143</td> <td> 0.002</td> <td>-3.38e+09</td> <td>-7.83e+08</td>
</tr>
<tr>
  <th>C(city)[ Depok]</th>           <td>-1.197e+09</td> <td> 3.65e+08</td> <td>   -3.284</td> <td> 0.001</td> <td>-1.91e+09</td> <td>-4.83e+08</td>
</tr>
<tr>
  <th>C(city)[ Jakarta Barat]</th>   <td>-5.726e+08</td> <td> 9.89e+08</td> <td>   -0.579</td> <td> 0.562</td> <td>-2.51e+09</td> <td> 1.36e+09</td>
</tr>
<tr>
  <th>C(city)[ Jakarta Selatan]</th> <td>  4.87e+09</td> <td> 1.32e+09</td> <td>    3.699</td> <td> 0.000</td> <td> 2.29e+09</td> <td> 7.45e+09</td>
</tr>
<tr>
  <th>C(city)[ Jakarta Timur]</th>   <td>-9.226e+08</td> <td> 4.83e+08</td> <td>   -1.910</td> <td> 0.056</td> <td>-1.87e+09</td> <td> 2.39e+07</td>
</tr>
<tr>
  <th>C(city)[ Jakarta Utara]</th>   <td> 2.039e+09</td> <td> 1.92e+09</td> <td>    1.062</td> <td> 0.288</td> <td>-1.72e+09</td> <td>  5.8e+09</td>
</tr>
<tr>
  <th>C(city)[ Tangerang]</th>       <td>-1.008e+09</td> <td> 5.77e+08</td> <td>   -1.745</td> <td> 0.081</td> <td>-2.14e+09</td> <td> 1.24e+08</td>
</tr>
<tr>
  <th>land_size_m2</th>              <td> 5.278e+06</td> <td> 2.57e+06</td> <td>    2.052</td> <td> 0.040</td> <td> 2.36e+05</td> <td> 1.03e+07</td>
</tr>
<tr>
  <th>building_size_m2</th>          <td> 1.822e+07</td> <td> 4.21e+06</td> <td>    4.326</td> <td> 0.000</td> <td> 9.97e+06</td> <td> 2.65e+07</td>
</tr>
<tr>
  <th>fac_kolam_renang</th>          <td>  1.05e+09</td> <td> 3.42e+08</td> <td>    3.069</td> <td> 0.002</td> <td>  3.8e+08</td> <td> 1.72e+09</td>
</tr>
</table></div></div>
</div>
<p>A lot of negative coefficient of <code class="docutils literal notranslate"><span class="pre">city</span></code> shows that <code class="docutils literal notranslate"><span class="pre">Bekasi</span></code> may not be the city with lowest mean price. This is possibly caused by the similar average value of house price between those locations.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_set_transfd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">({</span><span class="s1">&#39;price_in_rp&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price_in_rp</th>
    </tr>
    <tr>
      <th>city</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Bekasi</th>
      <td>1,291,126,732.67</td>
    </tr>
    <tr>
      <th>Bogor</th>
      <td>2,511,373,844.12</td>
    </tr>
    <tr>
      <th>Depok</th>
      <td>1,263,725,108.23</td>
    </tr>
    <tr>
      <th>Jakarta Barat</th>
      <td>4,794,971,098.27</td>
    </tr>
    <tr>
      <th>Jakarta Selatan</th>
      <td>15,567,246,445.50</td>
    </tr>
    <tr>
      <th>Jakarta Timur</th>
      <td>2,023,294,871.79</td>
    </tr>
    <tr>
      <th>Jakarta Utara</th>
      <td>13,660,223,214.29</td>
    </tr>
    <tr>
      <th>Tangerang</th>
      <td>3,673,188,679.25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The mean price between cities is similar except for <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Selatan</span></code> and <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code>:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Barat</span></code> and <code class="docutils literal notranslate"><span class="pre">Tangerang</span></code> has a bit higher price than <code class="docutils literal notranslate"><span class="pre">Bekasi</span></code>, <code class="docutils literal notranslate"><span class="pre">Bogor</span></code>, <code class="docutils literal notranslate"><span class="pre">Depok</span></code>. That is why their interval includes positive value of coefficient. Nevertheless, their interval includes 0 so we will drop them.</p></li>
<li><p>House located in <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Selatan</span></code> and <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code>, based on above, is believed to have a significantly higher price among others, so we will keep this features.</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">high_pvalue_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_tempat_jemuran&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jalur_telepon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_masjid&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_cctv&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kitchen_set&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_playground&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_wastafel&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_ac&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bola&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_mesin_cuci&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bulu_tangkis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kulkas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_water_heater&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_smart_home&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_backyard_luas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_garasi&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_balkon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_clubhouse&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_service_area&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_plumbing_system&#39;</span><span class="p">,</span>
    <span class="s1">&#39;maid_bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;maid_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;electricity_num&#39;</span>
<span class="p">]</span>
<span class="n">noise_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_one_gate_system&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_tempat_gym&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kolam_ikan&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_voli&#39;</span><span class="p">,</span> <span class="s1">&#39;carports&#39;</span><span class="p">,</span> <span class="s1">&#39;garages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fac_lapangan_basket&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_tenis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_akses_parkir&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_canopy&#39;</span>
<span class="p">]</span>
<span class="n">numerical_features</span> <span class="o">=</span> \
    <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_vif_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_pvalue_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">noise_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;price_in_rp ~ &#39;</span> <span class="o">+</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - 1 + &#39;</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(city)&#39;</span>
<span class="n">y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">train_set_transfd</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HC3&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
              <td></td>                 <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>C(city)[ Jakarta Selatan]</th> <td> 5.931e+09</td> <td> 1.18e+09</td> <td>    5.010</td> <td> 0.000</td> <td> 3.61e+09</td> <td> 8.25e+09</td>
</tr>
<tr>
  <th>C(city)[ Jakarta Utara]</th>   <td> 3.136e+09</td> <td> 1.35e+09</td> <td>    2.321</td> <td> 0.020</td> <td> 4.88e+08</td> <td> 5.78e+09</td>
</tr>
<tr>
  <th>land_size_m2</th>              <td> 4.739e+06</td> <td> 2.34e+06</td> <td>    2.026</td> <td> 0.043</td> <td> 1.54e+05</td> <td> 9.32e+06</td>
</tr>
<tr>
  <th>building_size_m2</th>          <td> 1.703e+07</td> <td> 3.31e+06</td> <td>    5.146</td> <td> 0.000</td> <td> 1.05e+07</td> <td> 2.35e+07</td>
</tr>
<tr>
  <th>fac_kolam_renang</th>          <td> 3.795e+08</td> <td> 4.96e+08</td> <td>    0.765</td> <td> 0.444</td> <td>-5.92e+08</td> <td> 1.35e+09</td>
</tr>
</table></div></div>
</div>
<p>Surprisingly <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code> now becomes significant! Hence our model assumes that house price in <code class="docutils literal notranslate"><span class="pre">Bekasi</span></code>, <code class="docutils literal notranslate"><span class="pre">Bogor</span></code>, <code class="docutils literal notranslate"><span class="pre">Depok</span></code>, <code class="docutils literal notranslate"><span class="pre">Tangerang</span></code>, <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Timur</span></code> and <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Barat</span></code> is similar.</p>
<p>The variability of <code class="docutils literal notranslate"><span class="pre">fac_kolam_renang</span></code> coefficient increases so we will drop this. Next thing to do is to apply proper Weighted Least Square and removing outliers.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">high_pvalue_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_tempat_jemuran&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jalur_telepon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_masjid&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_cctv&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kitchen_set&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_playground&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_wastafel&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_ac&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bola&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_mesin_cuci&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bulu_tangkis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kulkas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_water_heater&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_smart_home&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;fac_backyard_luas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_garasi&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_balkon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_clubhouse&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_service_area&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_plumbing_system&#39;</span><span class="p">,</span>
    <span class="s1">&#39;maid_bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;maid_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;electricity_num&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kolam_renang&#39;</span>
<span class="p">]</span>
<span class="n">noise_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;fac_one_gate_system&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_tempat_gym&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kolam_ikan&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_voli&#39;</span><span class="p">,</span> <span class="s1">&#39;carports&#39;</span><span class="p">,</span> <span class="s1">&#39;garages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fac_lapangan_basket&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_tenis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_akses_parkir&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_canopy&#39;</span>
<span class="p">]</span>
<span class="n">numerical_features</span> <span class="o">=</span> \
    <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_vif_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_pvalue_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">noise_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;price_in_rp ~ &#39;</span> <span class="o">+</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - 1 + &#39;</span>
<span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(city)&#39;</span>
<span class="n">y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">train_set_transfd</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HC3&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared (uncentered):</th>      <td>   0.576</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared (uncentered):</th> <td>   0.576</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>          <td>   230.7</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 31 Jan 2023</td> <th>  Prob (F-statistic):</th>          <td>4.07e-173</td>
</tr>
<tr>
  <th>Time:</th>                 <td>13:14:34</td>     <th>  Log-Likelihood:    </th>          <td> -73083.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  3040</td>      <th>  AIC:               </th>          <td>1.462e+05</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  3036</td>      <th>  BIC:               </th>          <td>1.462e+05</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     4</td>      <th>                     </th>              <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>         <td>HC3</td>       <th>                     </th>              <td> </td>    
</tr>
</table></div></div>
</div>
</section>
<section id="optimizing-multiple-regression">
<h3><strong>Optimizing Multiple Regression</strong><a class="headerlink" href="#optimizing-multiple-regression" title="Permalink to this headline">#</a></h3>
<p>We will apply Weighted Least Square to estimate coefficient. Variables that are responsible to heterscedacity are <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code> and <code class="docutils literal notranslate"><span class="pre">land_size_m2</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span><span class="c1"># Variables responsible for heteroscedacity</span>
<span class="c1"># Robust Regression</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">HetRobustRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">weight_</span>
<span class="n">weighted_resid</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
<span class="c1"># matpltlib plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">weighted_resid</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">weighted_resid</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Residual plot, WLS</span><span class="se">\n</span><span class="s1"> RMSE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y_hat&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;residual&#39;)
</pre></div>
</div>
<img alt="_images/3 - Linear Modeling of House Price_96_1.png" src="_images/3 - Linear Modeling of House Price_96_1.png" />
</div>
</div>
<p>As can be seen clearly on above figure, there are observations that act as outliers. We will use the same method that has already explained previously.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cook Distance</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">diags</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># no intercept</span>
<span class="n">Xw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span>
<span class="n">yw</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">Xw</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">Xw</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">Xw</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">H</span><span class="p">)</span> <span class="o">@</span> <span class="n">yw</span>
<span class="n">se2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">resid</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="c1"># se2 = SSE / (n - p), p = 1 since no intercept</span>
<span class="c1"># leverage is (weighted) hat matrix diagonal</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<span class="n">student_resid</span> <span class="o">=</span> <span class="n">resid</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">se2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span>
<span class="n">cooks_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">se2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span>
<span class="n">high_influence_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">cooks_dist</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">)))</span>
<span class="n">high_influence_obs_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">high_influence_obs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># High Influence Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">student_resid</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> 
    <span class="n">s</span><span class="o">=</span> <span class="n">cooks_dist</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span> <span class="o">*</span> <span class="mi">500</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">student_resid</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> 
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">cooks_dist</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">]</span> <span class="o">*</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;high influence&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lev</span><span class="p">,</span> <span class="n">stud_resid</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
    <span class="n">h</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">student_resid</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">high_influence_obs_index</span><span class="p">]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">stud_resid</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;studentized residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Leverage vs Studentized Residual&#39;</span><span class="p">)</span>
<span class="c1"># Cook&#39;s distance Plot</span>
<span class="n">obs_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">obs_index</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">cooks_dist</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">obs_index</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">cooks_dist</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> 
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Outliers&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">obs_index</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">],</span> <span class="n">cooks_dist</span><span class="p">[</span><span class="n">high_influence_obs</span><span class="p">]]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x_</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cook</span><span class="se">\&#39;</span><span class="s1">s distance plot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cook</span><span class="se">\&#39;</span><span class="s1">s distance&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Obs. Number&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;Obs. Number&#39;)
</pre></div>
</div>
<img alt="_images/3 - Linear Modeling of House Price_98_1.png" src="_images/3 - Linear Modeling of House Price_98_1.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">high_influence_obs</span><span class="p">]</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="c1"># Variables responsible for heteroscedacity</span>
<span class="c1"># Robust Regression</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">HetRobustRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">weight_</span>
<span class="n">weighted_resid</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
<span class="c1"># matpltlib plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">weighted_resid</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">weighted_resid</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Residual plot, WLS</span><span class="se">\n</span><span class="s1"> RMSE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">, R2 = </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y_hat&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_99_0.png" src="_images/3 - Linear Modeling of House Price_99_0.png" />
</div>
</div>
<p>Above residual plot shows that our dataset has a tolerated variability for house price no more than Rp. 5,000,000,000. It is suggested that the prediction is realible if the predicted house price is no more than Rp. 5,000,000,000.</p>
<p>Next, we will verify the confidence interval of regression coefficient.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">dump</span><span class="p">,</span> <span class="n">load</span>

<span class="k">def</span> <span class="nf">coefficient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_null</span><span class="p">,</span> <span class="n">boot_resid</span><span class="p">):</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_null</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span> <span class="c1"># Flachair&#39;s pick distribution</span>
    <span class="n">boot_resid_</span> <span class="o">=</span> <span class="n">boot_resid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">resid_dgp</span> <span class="o">=</span> <span class="n">boot_resid_</span> <span class="o">*</span> <span class="n">epsilon</span>
    <span class="n">y_dgp</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_null</span> <span class="o">+</span> <span class="n">resid_dgp</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lm_boots</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">result_boots</span> <span class="o">=</span> <span class="n">lm_boots</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_dgp</span><span class="p">)</span>
    <span class="n">coef_boots</span> <span class="o">=</span> <span class="n">result_boots</span><span class="o">.</span><span class="n">coef_</span>
    <span class="k">return</span> <span class="n">coef_boots</span>

<span class="c1"># prediction</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">HetRobustRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="s1">&#39;modules</span><span class="se">\\</span><span class="s1">fitted_regressor.joblib&#39;</span><span class="p">)</span> <span class="c1"># store fitted regressor</span>
<span class="n">y_predict</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># y_predict here serves beta as the null hypotheses for bootstrap</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">coef_</span>
<span class="c1"># calculate hat matrix</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="c1">#  = h_t in Flachair (2003)</span>
<span class="c1"># calculate adjusted residual</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_predict</span> <span class="c1"># = OLS restricted residuals in Flachair (2003)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="c1"># using HC3 as proposed by Flachair (2003)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">residual</span>
<span class="n">adj_resid</span> <span class="o">=</span> <span class="n">resid</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
<span class="c1"># bootstrap ci</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">sample</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">)</span>
<span class="n">confidence_level</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">lower_tail</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">upper_tail</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">lower_tail</span> 
<span class="n">bootstrap_res</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span>
    <span class="n">sample</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arr</span><span class="p">:</span> <span class="n">coefficient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">,</span> <span class="n">adj_resid</span><span class="p">),</span> <span class="n">vectorized</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="n">n_resamples</span><span class="o">=</span><span class="mi">9999</span>
<span class="p">)</span>
<span class="c1"># Features</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">coef</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">features_name</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_name</span><span class="p">)</span>
<span class="c1"># bootstrapping distribution</span>
<span class="n">n_iter</span> <span class="o">=</span> <span class="mi">9999</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_iter</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">bootstrap_coeff_value</span> <span class="o">=</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">coefficient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">,</span> <span class="n">adj_resid</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
<span class="c1"># plotting bootstrap result</span>
<span class="n">conf_low</span> <span class="o">=</span> <span class="n">bootstrap_res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">conf_high</span> <span class="o">=</span> <span class="n">bootstrap_res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">coef_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">features_name</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">conf_low</span><span class="p">,</span> <span class="n">conf_high</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">p</span><span class="p">))</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">coef_</span><span class="p">,</span> <span class="n">ci_l_</span><span class="p">,</span> <span class="n">ci_h_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coef_array</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">bootstrap_coeff_value</span><span class="p">[:,</span> <span class="n">index</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">coef_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ci_l_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ci_h_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Coefficient Value Distribution, </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xticks</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;coefficient value&#39;</span><span class="p">)</span>
    <span class="c1"># Q-Q Plot</span>
    <span class="n">pplot</span> <span class="o">=</span> <span class="n">ProbPlot</span><span class="p">(</span><span class="n">bootstrap_coeff_value</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">pplot</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">yticks</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Q-Q Plot, </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coeff value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_101_0.png" src="_images/3 - Linear Modeling of House Price_101_0.png" />
</div>
</div>
<p>From above confidence interval, except <code class="docutils literal notranslate"><span class="pre">building_size_m2</span></code>, in 95% confidence level there is evidence that the coefficients include 0 terms which mean, statistically, the variables is not useful to explains the linear relationship for house price.</p>
<p>So far, our weighted multiple regression parameters are explained as below:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">coef_array</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;features_name&#39;</span><span class="p">,</span> <span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="s1">&#39;conf_low&#39;</span><span class="p">,</span> <span class="s1">&#39;conf_high&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;features_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>conf_low</th>
      <th>conf_high</th>
    </tr>
    <tr>
      <th>features_name</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C(city)[ Jakarta Selatan]</th>
      <td>1,019,125,860.57</td>
      <td>-2,541,770,293.71</td>
      <td>4,554,861,283.75</td>
    </tr>
    <tr>
      <th>C(city)[ Jakarta Utara]</th>
      <td>2,091,510,620.53</td>
      <td>-958,306,883.05</td>
      <td>5,183,416,642.22</td>
    </tr>
    <tr>
      <th>land_size_m2</th>
      <td>2,541,730.38</td>
      <td>-837,110.83</td>
      <td>5,879,130.00</td>
    </tr>
    <tr>
      <th>building_size_m2</th>
      <td>12,005,662.20</td>
      <td>7,831,180.12</td>
      <td>16,328,811.03</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a id="4-predictive-performance"> </a></p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="predictive-performance-of-linear-model">
<h1>4. Predictive Performance of Linear Model<a class="headerlink" href="#predictive-performance-of-linear-model" title="Permalink to this headline">#</a></h1>
<p>In this section, we will assess our linear model’s performance in generalizing house price for unknown data. We will use <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">set</span></code> that is excluded in every analysis of our linear model building. This guarantees that there is no information leaked to our model.</p>
<p>We will compare all of the models that has been developed: 1) Simple OLS, 2) Simple WLS, 3) Multiple OLS, 4) Multiple WLS. We will also create a transformer function to detect and remove outliers so that each of the model has equal outliers treatment.</p>
<p>Note that our data has a tolerated variability for house price no more than Rp. 5,000,000,000 so let’s consider this as the maximum value to be predicted.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrix</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="k">def</span> <span class="nf">transform_set</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">high_pvalue_features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;fac_tempat_jemuran&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jalur_telepon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_jogging_track&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_masjid&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;fac_cctv&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kitchen_set&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_playground&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_wastafel&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_ac&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bola&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;fac_mesin_cuci&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_bulu_tangkis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kulkas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_water_heater&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_smart_home&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;fac_backyard_luas&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_garasi&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_balkon&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_clubhouse&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_service_area&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_plumbing_system&#39;</span><span class="p">,</span>
        <span class="s1">&#39;maid_bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;maid_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;electricity_num&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kolam_renang&#39;</span>
    <span class="p">]</span>
    <span class="n">noise_features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;fac_one_gate_system&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_tempat_gym&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_kolam_ikan&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_voli&#39;</span><span class="p">,</span> <span class="s1">&#39;carports&#39;</span><span class="p">,</span> <span class="s1">&#39;garages&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fac_lapangan_basket&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_lapangan_tenis&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_akses_parkir&#39;</span><span class="p">,</span> <span class="s1">&#39;fac_canopy&#39;</span>
    <span class="p">]</span>
    <span class="n">numerical_features</span> <span class="o">=</span> \
        <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span>\
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_vif_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">high_pvalue_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">noise_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">f</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - 1 + &#39;</span>
    <span class="n">f</span> <span class="o">+=</span> <span class="s1">&#39;C(city)&#39;</span>
    <span class="n">X_transfd</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
    <span class="n">X_transfd</span> <span class="o">=</span> <span class="n">X_transfd</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">X_transfd</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_transfd</span>

<span class="k">def</span> <span class="nf">remove_outliers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; For OLS only&quot;&quot;&quot;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">H</span><span class="p">)</span> <span class="o">@</span> <span class="n">y</span>
    <span class="n">se2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">resid</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
    <span class="c1"># leverage is (weighted) hat matrix diagonal</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
    <span class="n">cooks_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">se2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span>
    <span class="n">high_influence_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">cooks_dist</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">)))</span>
    <span class="n">high_influence_obs_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">high_influence_obs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="n">high_influence_obs_index</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="n">high_influence_obs_index</span> <span class="p">]</span>

<span class="n">y_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\y_test.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span> <span class="o">&lt;</span> <span class="mf">5e9</span><span class="p">)</span> <span class="c1"># Setting constraint of our prediction to be &lt; Rp. 5,000,000,000</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\X_test.csv&#39;</span><span class="p">)[</span><span class="n">y_mask</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_mask</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">transform_set</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">Z_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<span class="c1"># prepared model</span>
<span class="n">X_fit_simple</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\X_train.csv&#39;</span><span class="p">)[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_fit_simple</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\y_train.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">X_fit_multiple</span> <span class="o">=</span> <span class="n">transform_set</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\X_train.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_fit_multiple</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\y_train.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">X_fit_simple</span><span class="p">,</span> <span class="n">y_fit_simple</span> <span class="o">=</span> <span class="n">remove_outliers</span><span class="p">(</span><span class="n">X_fit_simple</span><span class="p">,</span> <span class="n">y_fit_simple</span><span class="p">)</span>
<span class="n">X_fit_multiple</span><span class="p">,</span> <span class="n">y_fit_multiple</span> <span class="o">=</span> <span class="n">remove_outliers</span><span class="p">(</span><span class="n">X_fit_multiple</span><span class="p">,</span> <span class="n">y_fit_multiple</span><span class="p">)</span>
<span class="n">regressor_1</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y_fit_simple</span><span class="p">,</span> <span class="n">X_fit_simple</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="c1"># single regressor using `building_size_m2`</span>
<span class="n">regressor_2</span> <span class="o">=</span> <span class="n">lm_2b</span> <span class="c1"># single regressor (weighted) using `building_size_m2`</span>
<span class="n">regressor_3</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y_fit_multiple</span><span class="p">,</span> <span class="n">X_fit_multiple</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="c1"># multiple regressor, [y, X] from train set</span>
<span class="n">regressor_4</span> <span class="o">=</span> <span class="n">results</span> <span class="c1"># weighted multiple regressor</span>
<span class="c1"># predict</span>
<span class="n">y_test_pred_1</span> <span class="o">=</span> <span class="n">regressor_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_test_pred_2</span> <span class="o">=</span> <span class="n">regressor_2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_test_pred_3</span> <span class="o">=</span> <span class="n">regressor_3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_test_pred_4</span> <span class="o">=</span> <span class="n">regressor_4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># residual</span>
<span class="n">resid_test_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_1</span><span class="p">)</span>
<span class="n">resid_test_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_2</span><span class="p">)</span>
<span class="n">resid_test_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_3</span><span class="p">)</span>
<span class="n">resid_test_4</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_4</span><span class="p">)</span>
<span class="c1"># mse</span>
<span class="n">rmse_test_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
<span class="n">rmse_test_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
<span class="n">rmse_test_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_3</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
<span class="n">rmse_test_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_4</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
<span class="c1"># create df</span>
<span class="n">resid_test_1</span> <span class="o">=</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
    <span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">y_test_pred_1</span><span class="p">,</span> 
    <span class="n">resid_test_1</span><span class="p">,</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Simple Regression,</span><span class="se">\n</span><span class="s1">rmse = </span><span class="si">{</span><span class="n">rmse_test_1</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> 
    <span class="n">n_samples</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">resid_test_2</span> <span class="o">=</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
    <span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">y_test_pred_2</span><span class="p">,</span> 
    <span class="n">resid_test_2</span><span class="p">,</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Simple Regression (weighted),</span><span class="se">\n</span><span class="s1">rmse = </span><span class="si">{</span><span class="n">rmse_test_2</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> 
    <span class="n">n_samples</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">resid_test_3</span> <span class="o">=</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
    <span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">y_test_pred_3</span><span class="p">,</span> 
    <span class="n">resid_test_3</span><span class="p">,</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Multiple Regression,</span><span class="se">\n</span><span class="s1">rmse = </span><span class="si">{</span><span class="n">rmse_test_3</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> 
    <span class="n">n_samples</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">resid_test_4</span> <span class="o">=</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
    <span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>    
    <span class="n">y_test_pred_4</span><span class="p">,</span> 
    <span class="n">resid_test_4</span><span class="p">,</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Multiple Regression (weighted),</span><span class="se">\n</span><span class="s1">rmse = </span><span class="si">{</span><span class="n">rmse_test_4</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> 
    <span class="n">n_samples</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

<span class="n">resid_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">resid_test_1</span><span class="p">,</span> <span class="n">resid_test_2</span><span class="p">,</span> <span class="n">resid_test_3</span><span class="p">,</span> <span class="n">resid_test_4</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_test&#39;</span><span class="p">,</span> <span class="s1">&#39;y_pred&#39;</span><span class="p">,</span> <span class="s1">&#39;resid&#39;</span><span class="p">,</span> <span class="s1">&#39;regressor&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">resid_df</span> <span class="o">=</span> <span class="n">resid_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">resid_df</span><span class="o">.</span><span class="n">y_test</span><span class="p">),</span>
    <span class="n">y_pred</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">resid_df</span><span class="o">.</span><span class="n">y_pred</span><span class="p">),</span>
    <span class="n">resid</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">resid_df</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
    <span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">resid_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;y_test&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;resid&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;regressor&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span>
    <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">resid_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;resid&#39;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;regressor&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">xticks_1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks_1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xticks_1</span><span class="p">])</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y_test, in rupiah&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;resid, in rupiah&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;resid, in rupiah&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1e10</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">)</span>
<span class="n">xticks_2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks_2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xticks_2</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_106_0.png" src="_images/3 - Linear Modeling of House Price_106_0.png" />
</div>
</div>
<p>From above figure, it is clear that the OLS is biased (even after removing the high-influence observations!). The distribution of WLS is somewhat more-normal than the OLS. Note that we plot raw (non-weighted) residuals here. We can also see some of the observations that are predicted poorly by the OLS but WLS gives good results.</p>
<p>Simple WLS is a bit more superior than multiple regression here. The result is similar, which possibly proves the confidence interval of multiple regression’s coefficients that includes 0 term. But note that, for our next section, we prefer model with more predictor variables.</p>
<p>The RMSE also uses raw residual. However, the value is quite high but this is probably caused by the presence of unusual observations here that all of the model agreed upon. Let’s see the summary statistics for those residuals:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_test_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_1</span><span class="p">)</span>
<span class="n">resid_test_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_2</span><span class="p">)</span>
<span class="n">resid_test_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_3</span><span class="p">)</span>
<span class="n">resid_test_4</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test_pred_4</span><span class="p">)</span>
<span class="n">resid_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">resid_test_1</span><span class="p">,</span> <span class="n">resid_test_2</span><span class="p">,</span> <span class="n">resid_test_3</span><span class="p">,</span> <span class="n">resid_test_4</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Simple Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Simple Regression (weighted)&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Multiple Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Multiple Regression (weighted)&#39;</span>
        <span class="p">],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span>
<span class="p">)</span>
<span class="n">resid_df</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;50%&#39;</span><span class="p">:</span> <span class="s1">&#39;median&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Simple Regression</th>
      <th>Simple Regression (weighted)</th>
      <th>Multiple Regression</th>
      <th>Multiple Regression (weighted)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>284.00</td>
      <td>284.00</td>
      <td>284.00</td>
      <td>284.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-2,636,008,995.02</td>
      <td>-310,386,221.08</td>
      <td>-3,724,053,535.27</td>
      <td>-268,599,296.45</td>
    </tr>
    <tr>
      <th>std</th>
      <td>4,372,181,548.81</td>
      <td>1,979,699,159.02</td>
      <td>7,338,596,286.50</td>
      <td>2,156,522,970.10</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-66,540,868,206.60</td>
      <td>-29,980,747,102.80</td>
      <td>-92,371,368,846.86</td>
      <td>-33,178,245,911.41</td>
    </tr>
    <tr>
      <th>10%</th>
      <td>-4,626,578,998.99</td>
      <td>-1,084,199,854.11</td>
      <td>-5,564,749,963.78</td>
      <td>-961,738,259.02</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-3,043,332,518.69</td>
      <td>-471,357,578.39</td>
      <td>-3,188,001,451.33</td>
      <td>-398,732,472.37</td>
    </tr>
    <tr>
      <th>median</th>
      <td>-1,756,142,549.94</td>
      <td>-175,744,611.45</td>
      <td>-1,979,248,081.77</td>
      <td>-174,567,156.44</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>-1,151,489,929.69</td>
      <td>203,762,752.22</td>
      <td>-1,416,757,645.19</td>
      <td>219,288,996.36</td>
    </tr>
    <tr>
      <th>90%</th>
      <td>-778,697,888.18</td>
      <td>691,710,546.97</td>
      <td>-1,047,140,400.36</td>
      <td>708,342,579.92</td>
    </tr>
    <tr>
      <th>max</th>
      <td>147,547,907.60</td>
      <td>2,341,155,173.83</td>
      <td>818,892,903.29</td>
      <td>2,266,224,842.65</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Weighted multiple regression seems a bit more accurate than weighted simple regression, the mean residual is closer to zero and the quantile range is narrower than weighted simple regression.</p>
<p>Although the RMSE is quite big, look at the distance between the <code class="docutils literal notranslate"><span class="pre">median</span></code> and the <code class="docutils literal notranslate"><span class="pre">quantiles</span></code>. Quantiles of weigthed multiple regression only differs from its median by at most <span class="math notranslate nohighlight">\(150,000,000\)</span> (150 millions). Turns out the model performs well for unknown data.</p>
<p><a id="5-implementation"> </a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="implementation-of-parametric-model-way-to-maximize-house-selling-profit-for-developer">
<h1>5. Implementation of Parametric Model: Way to Maximize House-Selling Profit for Developer<a class="headerlink" href="#implementation-of-parametric-model-way-to-maximize-house-selling-profit-for-developer" title="Permalink to this headline">#</a></h1>
<p><a id="5-1-case-example"> </a></p>
<section id="case-example">
<h2>5.1. Case Example<a class="headerlink" href="#case-example" title="Permalink to this headline">#</a></h2>
<p>Suppose a fictitious case example for designing general parameter of housing project. The output is to find the solution to maximize house selling profit given the cost (budget) to build a house with several requirement. The objectives:</p>
<ol class="simple">
<li><p>Determine the general (high-level) parameter about housing related to price sentiment of Jabodetabek that can be associated from mathematical model (in our case, linear equation).</p></li>
<li><p>Develop mathematical solution to find the optimal value of each parameter that can maximize profit, which comply with requirements/constraints that are determined by each division from developer team.</p></li>
</ol>
<p>Below explained some simple example of possible request/constraint to be explained/fulfilled:</p>
<ol class="simple">
<li><p><em>Project Division</em> determined that maximum budget of project cost specific for house production (regardless of how many house to build) is <code class="docutils literal notranslate"><span class="pre">Rp.</span> <span class="pre">15,000,000,000</span> <span class="pre">(15</span> <span class="pre">billion</span> <span class="pre">rupiahs)</span></code>. <code class="docutils literal notranslate"><span class="pre">Production</span> <span class="pre">cost</span> <span class="pre">per</span> <span class="pre">unit</span></code> for several parameters is given in <code class="docutils literal notranslate"><span class="pre">unit_price.xlsx</span></code>.</p></li>
<li><p><em>Designer Division</em> determined that the <code class="docutils literal notranslate"><span class="pre">land</span> <span class="pre">size</span></code> (for each house) shall be minimum <code class="docutils literal notranslate"><span class="pre">1.5</span> <span class="pre">times</span> <span class="pre">of</span> <span class="pre">house</span> <span class="pre">footprint</span></code>. <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">floors</span></code> shall be <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">more</span> <span class="pre">than</span> <span class="pre">2</span></code>. Building area for second floor is <code class="docutils literal notranslate"><span class="pre">generally</span> <span class="pre">60%</span> <span class="pre">of</span> <span class="pre">footprint</span> <span class="pre">area</span></code>. Designer also requested to explain the designated <code class="docutils literal notranslate"><span class="pre">building</span> <span class="pre">size</span></code> that is popular among Jabodetabek household.</p></li>
<li><p><em>Legal Division</em> can secure land price for several Jabodetabek area that is given in <code class="docutils literal notranslate"><span class="pre">land_cost.xlsx</span></code>. The spreadsheet also contains available (non-occupied) land area that can be fully provided for housing project.</p></li>
<li><p><em>Marketing Division</em> requested to explain various possible pricing options such as: <code class="docutils literal notranslate"><span class="pre">average/standard</span> <span class="pre">price</span></code>, <code class="docutils literal notranslate"><span class="pre">promotion</span> <span class="pre">price</span></code>, and <code class="docutils literal notranslate"><span class="pre">optimistic</span> <span class="pre">full-profit</span> <span class="pre">price</span></code>.</p></li>
</ol>
<p><a id="5-2-solution"> </a></p>
</section>
<section id="solution">
<h2>5.2. Solution<a class="headerlink" href="#solution" title="Permalink to this headline">#</a></h2>
<p><a id="assumption"> </a></p>
<section id="assumption">
<h3><strong>Assumption</strong><a class="headerlink" href="#assumption" title="Permalink to this headline">#</a></h3>
<p>We interpret how <em>Jabodetabek household</em> values price of the house based on sample taken from third party website that contain listing of offered house price (new and used). The idea is, when they list the price for their house, it can be treated as their <em>unconscious</em> assumption of the house price given every parameter: their house location, building size, land size, etc. With many records of Jabodetabek house listing, we treat them to infer the <em>value</em> of a house in <em>consumer’s perspective</em>.</p>
<p>Then by generalizing the house price using mathematical equation, we predict what is the average of house price given its characteristic. We can also estimate how much margin from average price until that price is categorized as <code class="docutils literal notranslate"><span class="pre">overpriced</span></code> or <code class="docutils literal notranslate"><span class="pre">underpriced</span></code>.</p>
<p>To simplify the optimization proces, we assume that every location is equally popular and demanding in term of marketing speculation, thus the selection of project location purely accounted by the price alone.</p>
<p><a id="general-parameters"> </a></p>
</section>
<section id="general-parameters">
<h3><strong>General Parameters</strong><a class="headerlink" href="#general-parameters" title="Permalink to this headline">#</a></h3>
<p>We already developed linear equation which its parameters are proven to be statistically significant as a generalization of Jabodetabek House Price sentiment.</p>
<p>The linear equation provides <code class="docutils literal notranslate"><span class="pre">conditional</span> <span class="pre">mean</span> <span class="pre">given</span> <span class="pre">x*</span></code>, i.e. average house price on its specific value of parameters. The selected equation can be written as:</p>
<div class="math notranslate nohighlight">
\[house\;price = 2,541,730\;land\;size\;+\;12,005,662\;building\;size\;\]</div>
<p>Above equation is a base case of house price for house located in <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Barat,</span> <span class="pre">Jakarta</span> <span class="pre">Timur,</span> <span class="pre">Bekasi,</span> <span class="pre">Depok,</span> <span class="pre">Bogor</span></code>, <code class="docutils literal notranslate"><span class="pre">Tangerang</span></code>, suggests that the house price is generally typical between those locations.</p>
<p>For specific case where location is in <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Selatan</span></code>, the mean house price is elevated by Rp. 1,019,125,860.</p>
<p>For specific case where location is in <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code>, the mean house price is elevated by Rp. 2,091,510,620.</p>
<p>So, the equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}house\;price=\begin{cases}
    2,541,730\;land\;size\;+\;12,005,662\;building\;size+1,019,125,860&amp;\text{if in Jakarta Selatan}\\
    2,541,730\;land\;size\;+\;12,005,662\;building\;size+2,091,510,620&amp;\text{if in Jakarta Utara}\\
    2,541,730\;land\;size\;+\;12,005,662\;building\;size&amp;\text{for other Jabodetabek Area}\end{cases}\end{split}\]</div>
<p>But as explained previously, our linear model performance is proven optimal only for predicting <code class="docutils literal notranslate"><span class="pre">price</span> <span class="pre">&lt;</span> <span class="pre">Rp.</span> <span class="pre">5,000,000,000</span></code>. This sets our linear model constraints.</p>
<p>So the general parameters are:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Land</span> <span class="pre">size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Building</span> <span class="pre">size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Location</span></code>, whether the house is specifically located in one of <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Selatan</span></code> or <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code>.</p></li>
</ol>
</section>
<section id="sentiment-about-building-size">
<h3><strong>Sentiment about Building Size</strong><a class="headerlink" href="#sentiment-about-building-size" title="Permalink to this headline">#</a></h3>
<p>Based on sample, we can observe popularity of building size based on its distribution:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">house_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Dataset\jabodetabek_house_data_prcsd.csv&#39;</span><span class="p">)</span>
<span class="n">house_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">house_df</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Jakarta&#39;</span><span class="p">),</span> <span class="s1">&#39;city&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; DKI Jakarta&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">house_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">,</span> 
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">ecdfplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">house_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Building Size Histogram&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># ax[1].text(x=5*10e6, y=0.52, s=f&#39;Proportion = 0.5,\nMedian={median:,.0f}&#39;)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Empirical Cumulative Density Function&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;building_size_m2, in IDR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_124_0.png" src="_images/3 - Linear Modeling of House Price_124_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">house_df</span><span class="p">[[</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;50%&#39;</span><span class="p">:</span> <span class="s1">&#39;median&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>median</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>building_size_m2</th>
      <td>3,443.00</td>
      <td>186.96</td>
      <td>249.52</td>
      <td>18.00</td>
      <td>67.00</td>
      <td>113.00</td>
      <td>205.00</td>
      <td>6,000.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we interpert 50% percentile as the most popular building size, we found that around 100 m2 is quite popular. Suggested building size range based on above distribution may cover 25% and 75% percentile then:</p>
<div class="math notranslate nohighlight">
\[building\;size = [60m^2,\;200m^2]\]</div>
<p>Furthermore, we can possibly inspect the building size pattern for each location using plot below:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">building_size_filter</span> <span class="o">=</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
        <span class="p">(</span><span class="n">house_df</span><span class="o">.</span><span class="n">building_size_m2</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">),</span>
        <span class="p">(</span><span class="n">house_df</span><span class="o">.</span><span class="n">building_size_m2</span> <span class="o">&lt;=</span> <span class="mi">200</span><span class="p">)</span>
        <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">house_df</span><span class="p">[</span><span class="n">building_size_filter</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;land_size_m2&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;building_size_m2&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;city&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">(</span><span class="n">xy1</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">xy2</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3 - Linear Modeling of House Price_129_0.png" src="_images/3 - Linear Modeling of House Price_129_0.png" />
</div>
</div>
<p>Diagonal line with black color represents <code class="docutils literal notranslate"><span class="pre">building_size</span> <span class="pre">=</span> <span class="pre">land_size</span></code>, so observations that plotted above this line may suggest building with more than 1 floors.</p>
<p>Some distinguishable pattern:</p>
<ol class="simple">
<li><p>Building size &lt; <span class="math notranslate nohighlight">\(100\;m^2\)</span> is quite popular in <code class="docutils literal notranslate"><span class="pre">Tangerang</span></code></p></li>
<li><p>House that has more than 1 floor is popular in <code class="docutils literal notranslate"><span class="pre">DKI</span> <span class="pre">Jakarta</span></code>.</p></li>
<li><p>Possibly 1 floored house is popular in <code class="docutils literal notranslate"><span class="pre">Bogor</span></code>.</p></li>
</ol>
<p><a id="mathematical-problems"> </a></p>
</section>
<section id="c-mathematical-problems-to-solve">
<h3><strong>C. Mathematical Problems to Solve</strong><a class="headerlink" href="#c-mathematical-problems-to-solve" title="Permalink to this headline">#</a></h3>
<p>Production cost of house alone is described as below:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;Dataset/unit_price.xlsx&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>work_item</th>
      <th>variable</th>
      <th>price</th>
      <th>unit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>land prep</td>
      <td>land_size_m2</td>
      <td>1000000</td>
      <td>rp/m2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>house build, 1 floor</td>
      <td>building_size_m2</td>
      <td>4500000</td>
      <td>rp/m2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>house build, 2 floor</td>
      <td>building_size_m2</td>
      <td>6000000</td>
      <td>rp/m2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="math notranslate nohighlight">
\[cost\;per\;house\;=\;land\;cost\;\times\;land\;size\;+\;1,000,000\;land\;size\;+\;(3,000,000\;+\;\;1,500,000\;floor)\;building\;size,\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\\floor\;=\;[1,\;2]\end{split}\]</div>
<div class="math notranslate nohighlight">
\[house\;nos.\times\;cost\;per\;house\leq\;15,000,000,000\]</div>
<p>Where land size and building size subjects of each a house to be constructed.</p>
<p>Land price per meter square and the available area are as below:</p>
<div class="cell tag_hide-input tag_output-scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;Dataset/land_price.xlsx&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>no</th>
      <th>location</th>
      <th>city</th>
      <th>price_per_m2</th>
      <th>available_area_m2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>bogor_1</td>
      <td>Bogor</td>
      <td>1200000</td>
      <td>600</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>bogor_2</td>
      <td>Bogor</td>
      <td>900000</td>
      <td>650</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>bogor_3</td>
      <td>Bogor</td>
      <td>2000000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>bogor_4</td>
      <td>Bogor</td>
      <td>1000000</td>
      <td>800</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>bogor_5</td>
      <td>Bogor</td>
      <td>2000000</td>
      <td>500</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>depok_1</td>
      <td>Depok</td>
      <td>800000</td>
      <td>300</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>depok_2</td>
      <td>Depok</td>
      <td>700000</td>
      <td>400</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>depok_3</td>
      <td>Depok</td>
      <td>900000</td>
      <td>600</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>jakut_1</td>
      <td>Jakarta Utara</td>
      <td>10000000</td>
      <td>100</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>jakut_2</td>
      <td>Jakarta Utara</td>
      <td>8000000</td>
      <td>150</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>jaksel_1</td>
      <td>Jakarta Selatan</td>
      <td>14000000</td>
      <td>80</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>tang_1</td>
      <td>Tangerang</td>
      <td>3000000</td>
      <td>600</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>tang_2</td>
      <td>Tangerang</td>
      <td>2000000</td>
      <td>300</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>tang_3</td>
      <td>Tangerang</td>
      <td>1500000</td>
      <td>500</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>bekasi_1</td>
      <td>Bekasi</td>
      <td>1300000</td>
      <td>300</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="math notranslate nohighlight">
\[land\;size\;\times\;house\;nos.\;\leq\;available\;area\]</div>
<p>Following <code class="docutils literal notranslate"><span class="pre">Designer</span> <span class="pre">Division</span></code> requirement regarding to land size:</p>
<div class="math notranslate nohighlight">
\[land\;size\;\geq1.5\;building\;footprint\]</div>
<p>According to designer specification of first floor (footprint) and second floor (60% of footprint), so:</p>
<div class="math notranslate nohighlight">
\[foot\;print=building\;size-(floor-1)\times\;0.6\times\;footprint\]</div>
<div class="math notranslate nohighlight">
\[foot\;print=building\;size/(1+0.6(floor-1))\]</div>
<p><a id="solution-optimization"> </a></p>
</section>
<section id="solution-optimization-function-and-implementation-using-pyomo">
<h3><strong>Solution: Optimization Function and Implementation using <em>Pyomo</em></strong><a class="headerlink" href="#solution-optimization-function-and-implementation-using-pyomo" title="Permalink to this headline">#</a></h3>
<p>Let variable of determining price-cost of house production be:</p>
<div class="math notranslate nohighlight">
\[x_1=house\;nos.,\;x_2=land\;size,\;x_3\;=building\;size,\;x_4=floor,\;x_5=land\;cost\]</div>
<div class="math notranslate nohighlight">
\[x_1\geq\;1\]</div>
<div class="math notranslate nohighlight">
\[(x_2\;,x_3,\;x_5)&gt;0\]</div>
<div class="math notranslate nohighlight">
\[x_4 = 1\;or\;2\]</div>
<p>and location variables:</p>
<div class="math notranslate nohighlight">
\[x_6=Jakarta\;Selatan,\;x_7=Jakarta\;Utara,\]</div>
<div class="math notranslate nohighlight">
\[\;x_8=Tangerang,\;x_9=Bogor,\;x_{10}=Depok,\;x_{11}=Bekasi\]</div>
<div class="math notranslate nohighlight">
\[x_{6..11} = 0\;or\;1\]</div>
<p>So we re-define the equation of project cost:</p>
<div class="math notranslate nohighlight">
\[cost=x_1(x_5\times\;x_2+1,000,000\;x_2+(3,000,000+1,500,000\;x_4)x_3)\]</div>
<div class="math notranslate nohighlight">
\[cost=x_1\times\;x_2\times\;x_5+1,000,000\;x_1\times\;x_2+3,000,000\;x_1\times\;x_3+1,500,000\;x_1\times\;x_3\times\;x_4\]</div>
<p>and expected price:</p>
<div class="math notranslate nohighlight">
\[price=x_1(2,541,730\;x_2+12,005,663\;x_3+1,019,125,860\;x_6+1,019,125,860\;x_7)\]</div>
<p>so:</p>
<div class="math notranslate nohighlight">
\[price=2,541,730\;x_1\times\;x_2+12,005,663\;x_1\times\;x_3\]</div>
<div class="math notranslate nohighlight">
\[+1,019,125,860\;x_1\times\;x_6+1,019,125,860\;x_1\times\;x_7\]</div>
<p>This result in following mathematical problem then,</p>
<p>Find:</p>
<div class="math notranslate nohighlight">
\[x_1,\;x_2,\;x_3,\;x_4\]</div>
<p>given:</p>
<div class="math notranslate nohighlight">
\[x_5,\;x_6,\;x_7,\;x_8\]</div>
<p>that maximize:</p>
<div class="math notranslate nohighlight">
\[y = price(x_1,\;x_2,\;x_3\;x_6,\;x_7,\;x_8) - cost(x_1,\;x_2,\;x_3,\;x_4,\;x_5)\]</div>
<p>or in other form, minimize (to suit with program that using algorithm to minimize cost function):</p>
<div class="math notranslate nohighlight">
\[y* = cost(x_1,\;x_2,\;x_3,\;x_4,\;x_5) - price(x_1,\;x_2,\;x_3\;x_6,\;x_7,\;x_8)\]</div>
<p>with constraint:</p>
<div class="math notranslate nohighlight">
\[cost(x_1,\;x_2,\;x_3,\;x_4,\;x_5)\leq\;(A=15,000,000,000)\]</div>
<div class="math notranslate nohighlight">
\[price(x_1,\;x_2,\;x_3,\;x_4,\;x_5)/x_1\leq\;(B=5,000,000,000)\]</div>
<div class="math notranslate nohighlight">
\[x_1\;\times\;x_2\leq\;C,\;where\;C=available\;area\]</div>
<div class="math notranslate nohighlight">
\[x_2\;(1+0.6(x_4-1))\;/x_3&gt;1.5\]</div>
<div class="math notranslate nohighlight">
\[60\leq\;x_3\leq\;200\]</div>
<div class="math notranslate nohighlight">
\[x_{1...5} &gt; 0\]</div>
<p>We iterate along <em>x<sub>5</sub> (land price)</em> and its corresponding <em>C (available area)</em> to find the maximized profit for that location, then we will compare which has the most profit among others.</p>
<p>So we will create a python function with i/o:</p>
<div class="math notranslate nohighlight">
\[F(x_5, x_6, x_7, x_8, A, B, C)\rightarrow(x_1,x_2,x_3,x_4,\;cost,\;mean\;price, \;prediction\;interval)\]</div>
<p>Prediction interval here can be determined. We can use 1 times of <code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">deviation</span> <span class="pre">of</span> <span class="pre">a</span> <span class="pre">distribution</span></code>, which explains <em>by how much, on average, the observations in that particular distribution differs from its own mean</em>. We then determine price tag for promotion (slightly lower price) or optimistic profit (slightly higher price), which then we select the price range by -1 to +1 times the standard deviation from mean price. The prediction interval will be determined as explained previously.</p>
<p>Below codes explains our problem definition and <em>solver</em> instantiation using <em>Pyomo</em> API.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="k">def</span> <span class="nf">get_solutions</span><span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">x6</span><span class="p">,</span> <span class="n">x7</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">price_func</span><span class="p">(</span><span class="n">model_</span><span class="p">):</span>
        <span class="c1"># Price func</span>
        <span class="n">price</span> <span class="o">=</span> \
            <span class="mf">2541730.38</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x2</span>\
                <span class="o">+</span> <span class="mf">12005662.20</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x3</span>\
                <span class="o">+</span> <span class="mf">1019125860.57</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x6</span>\
                <span class="o">+</span> <span class="mf">2091510620.53</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x7</span>
        <span class="k">return</span> <span class="n">price</span>

    <span class="k">def</span> <span class="nf">cost_func</span><span class="p">(</span><span class="n">model_</span><span class="p">):</span>
        <span class="n">cost</span> <span class="o">=</span> \
            <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x2</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x5</span>\
                <span class="o">+</span> <span class="mi">1000000</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x2</span>\
                <span class="o">+</span> <span class="mi">3000000</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x3</span>\
                <span class="o">+</span> <span class="mi">1500000</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x3</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x4</span>
        <span class="k">return</span> <span class="n">cost</span>

    <span class="k">def</span> <span class="nf">objective_func</span><span class="p">(</span><span class="n">model_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">price_func</span><span class="p">(</span><span class="n">model_</span><span class="p">)</span> <span class="o">-</span> <span class="n">cost_func</span><span class="p">(</span><span class="n">model_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cost_constraint</span><span class="p">(</span><span class="n">model_</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">cost_func</span><span class="p">(</span><span class="n">model_</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">model_</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">price_constraint</span><span class="p">(</span><span class="n">model_</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">price_func</span><span class="p">(</span><span class="n">model_</span><span class="p">)</span> <span class="o">/</span> <span class="n">model_</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">model_</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">area_constraint</span><span class="p">(</span><span class="n">model_</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">model_</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">model_</span><span class="o">.</span><span class="n">x2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">model_</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">footprint_const</span><span class="p">(</span><span class="n">model_</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">model_</span><span class="o">.</span><span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="p">(</span><span class="n">model_</span><span class="o">.</span><span class="n">x4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">model_</span><span class="o">.</span><span class="n">x3</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.5</span><span class="p">)</span>

    <span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;x1&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span><span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> 
        <span class="s1">&#39;x2&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;x3&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">200</span><span class="p">)),</span>
        <span class="s1">&#39;x4&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span>
        <span class="p">}</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;x5&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">x5</span><span class="p">),</span>
        <span class="s1">&#39;x6&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">x6</span><span class="p">),</span>
        <span class="s1">&#39;x7&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeIntegers</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">x7</span><span class="p">),</span>
        <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">A</span><span class="p">),</span>
        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">B</span><span class="p">),</span> 
        <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="n">pyo</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="c1"># setting up problem with pyomo API</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">var_key</span><span class="p">,</span> <span class="n">var_value</span> <span class="ow">in</span> <span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">var_key</span><span class="p">,</span> <span class="n">var_value</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param_key</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_key</span><span class="p">,</span> <span class="n">param_value</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">objective_func</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">cost_const</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">cost_constraint</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">price_const</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">price_constraint</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">area_const</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">area_constraint</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">foot_const</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">footprint_const</span><span class="p">)</span>
    <span class="c1"># instantiate the solver</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;scip&#39;</span><span class="p">,</span> <span class="n">solver_io</span><span class="o">=</span><span class="s1">&#39;nl&#39;</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
    <span class="n">opt</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;limits/time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">opt</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># output</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a look at above codes. Our problem is quadratic: contains involvement of variable multiplication. Some of the constraints are also non-linear. This possibly makes our problem a non-convex problem: multiple local minima may exist, which may not equal to the global minima. So the <code class="docutils literal notranslate"><span class="pre">options['limits/time']</span></code> is set to stop the process after certain time is passed. The solver may signal if any solution found.</p>
<p>Also, don’t forget about the prediction interval. We use the solved <code class="docutils literal notranslate"><span class="pre">model</span></code> as the input. We use <code class="docutils literal notranslate"><span class="pre">confidence_level</span> <span class="pre">=</span> <span class="pre">0.68</span></code> to get the interval of <code class="docutils literal notranslate"><span class="pre">mean</span></code> <span class="math notranslate nohighlight">\(\pm\)</span> <code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">deviation</span></code>. Recall that this means the <em>deviation, on average, from typical house price</em>. This explained in codes below:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_prediction_interval</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">quantile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">confidence_level</span><span class="o">=</span><span class="mf">0.68</span><span class="p">):</span>
    <span class="n">fitted_regressor</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;modules</span><span class="se">\\</span><span class="s1">fitted_regressor.joblib&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">x6</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">x7</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">x2</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">x3</span><span class="p">()])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">x2</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">x3</span><span class="p">()])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sigma2</span> <span class="o">=</span> <span class="n">fitted_regressor</span><span class="o">.</span><span class="n">variance_</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">fitted_regressor</span><span class="o">.</span><span class="n">get_sample_weight</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">sigma2i</span> <span class="o">=</span> <span class="n">sigma2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">confidence_level</span><span class="p">:</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">confidence_level</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">quantile</span><span class="p">)</span>
    <span class="n">resid_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2i</span><span class="p">)</span> <span class="o">*</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">resid_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2i</span><span class="p">)</span> <span class="o">*</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">fitted_regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">pi_low</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">resid_lower</span>
    <span class="n">pi_high</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">resid_upper</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">pi_low</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pi_high</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Below dataframe is used as the input:</p>
<div class="cell tag_hide-input tag_output-scroll tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># creating the dataframe</span>
<span class="n">input_to_optimize_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;Dataset/land_price.xlsx&#39;</span><span class="p">)</span>
<span class="n">input_to_optimize_df</span> <span class="o">=</span> <span class="n">input_to_optimize_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">x5</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">price_per_m2</span><span class="p">,</span>
    <span class="n">x6</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x7</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x8</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x9</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x10</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x11</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">A</span><span class="o">=</span><span class="mi">15000000000</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">5000000000</span><span class="p">,</span> 
    <span class="n">C</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">available_area_m2</span>
    <span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;x6&#39;</span><span class="p">:</span> <span class="s1">&#39;Jakarta Selatan&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;x7&#39;</span> <span class="p">:</span> <span class="s1">&#39;Jakarta Utara&#39;</span><span class="p">,</span>
    <span class="s1">&#39;x8&#39;</span> <span class="p">:</span> <span class="s1">&#39;Tangerang&#39;</span><span class="p">,</span>
    <span class="s1">&#39;x9&#39;</span> <span class="p">:</span> <span class="s1">&#39;Bogor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;x10&#39;</span> <span class="p">:</span> <span class="s1">&#39;Depok&#39;</span><span class="p">,</span>
    <span class="s1">&#39;x11&#39;</span> <span class="p">:</span> <span class="s1">&#39;Bekasi&#39;</span>
    <span class="p">}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">input_to_optimize_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">input_to_optimize_df</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span>
        <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">input_to_optimize_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>no</th>
      <th>location</th>
      <th>city</th>
      <th>price_per_m2</th>
      <th>available_area_m2</th>
      <th>x5</th>
      <th>x6</th>
      <th>x7</th>
      <th>x8</th>
      <th>x9</th>
      <th>x10</th>
      <th>x11</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>depok_3</td>
      <td>Depok</td>
      <td>900000</td>
      <td>600</td>
      <td>900000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>15000000000</td>
      <td>5000000000</td>
      <td>600</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>bogor_5</td>
      <td>Bogor</td>
      <td>2000000</td>
      <td>500</td>
      <td>2000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>15000000000</td>
      <td>5000000000</td>
      <td>500</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>depok_1</td>
      <td>Depok</td>
      <td>800000</td>
      <td>300</td>
      <td>800000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>15000000000</td>
      <td>5000000000</td>
      <td>300</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>bogor_3</td>
      <td>Bogor</td>
      <td>2000000</td>
      <td>1000</td>
      <td>2000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>15000000000</td>
      <td>5000000000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>tang_2</td>
      <td>Tangerang</td>
      <td>2000000</td>
      <td>300</td>
      <td>2000000</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>15000000000</td>
      <td>5000000000</td>
      <td>300</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now let’s wrap both of above functions and see the optimization results!</p>
<div class="cell tag_output-scroll tag_hide-input tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pyomo.core&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span> <span class="c1"># to adjust verbosity of the solver</span>
                                                        <span class="c1"># I decided to suppress the output to obtain clearer output cell</span>
                                                        <span class="c1"># however, all of the results in this analysis has found its solution</span>
<span class="c1"># desired output</span>
<span class="n">location_tag</span> <span class="o">=</span> <span class="n">input_to_optimize_df</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">values</span>
<span class="n">total_cost</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">net_return</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">roi</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">house_nos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cost_per_house</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">house_price</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">house_price_lower</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">house_price_upper</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">avail_land_size</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">total_land_occupied</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">land_size_per_house_m2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">house_size_m2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">floor_nos_each_house</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># iteration along the rows</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">input_to_optimize_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># input parameters</span>
    <span class="n">x5</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;x5&#39;</span><span class="p">]</span>
    <span class="n">x6</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;x6&#39;</span><span class="p">]</span>
    <span class="n">x7</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;x7&#39;</span><span class="p">]</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">get_solutions</span><span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">x6</span><span class="p">,</span> <span class="n">x7</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">pi_low</span><span class="p">,</span> <span class="n">pi_high</span> <span class="o">=</span> <span class="n">get_prediction_interval</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="c1"># append output for each iterations</span>
    <span class="n">total_cost</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">cost_const</span><span class="p">())</span>
    <span class="n">net_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">objective</span><span class="p">())</span>
    <span class="n">roi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">objective</span><span class="p">()</span> <span class="o">/</span> <span class="n">solution</span><span class="o">.</span><span class="n">cost_const</span><span class="p">())</span>
    <span class="n">house_nos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">x1</span><span class="p">())</span>
    <span class="n">cost_per_house</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">cost_const</span><span class="p">()</span> <span class="o">/</span> <span class="n">solution</span><span class="o">.</span><span class="n">x1</span><span class="p">())</span>
    <span class="n">house_price</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">price_const</span><span class="p">())</span>
    <span class="n">house_price_lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi_low</span><span class="p">)</span>
    <span class="n">house_price_upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi_high</span><span class="p">)</span>
    <span class="n">avail_land_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">C</span><span class="p">())</span>
    <span class="n">total_land_occupied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">area_const</span><span class="p">())</span>
    <span class="n">land_size_per_house_m2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">x2</span><span class="p">())</span>
    <span class="n">house_size_m2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">x3</span><span class="p">())</span>
    <span class="n">floor_nos_each_house</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">x4</span><span class="p">())</span>
<span class="c1"># create output df</span>
<span class="n">optimization_result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;location_tag&#39;</span><span class="p">:</span> <span class="n">location_tag</span><span class="p">,</span>
    <span class="s1">&#39;total_cost&#39;</span><span class="p">:</span> <span class="n">total_cost</span><span class="p">,</span>
    <span class="s1">&#39;net_return&#39;</span><span class="p">:</span> <span class="n">net_return</span><span class="p">,</span>
    <span class="s1">&#39;roi&#39;</span><span class="p">:</span> <span class="n">roi</span><span class="p">,</span>
    <span class="s1">&#39;house_nos&#39;</span><span class="p">:</span> <span class="n">house_nos</span><span class="p">,</span>
    <span class="s1">&#39;cost_per_house&#39;</span><span class="p">:</span> <span class="n">cost_per_house</span><span class="p">,</span>
    <span class="s1">&#39;house_price&#39;</span><span class="p">:</span> <span class="n">house_price</span><span class="p">,</span>
    <span class="s1">&#39;house_price_lower&#39;</span><span class="p">:</span> <span class="n">house_price_lower</span><span class="p">,</span>
    <span class="s1">&#39;house_price_upper&#39;</span><span class="p">:</span> <span class="n">house_price_upper</span><span class="p">,</span>
    <span class="s1">&#39;avail_land_m2&#39;</span><span class="p">:</span> <span class="n">avail_land_size</span><span class="p">,</span>
    <span class="s1">&#39;total_land_occupied&#39;</span><span class="p">:</span> <span class="n">total_land_occupied</span><span class="p">,</span>
    <span class="s1">&#39;land_size_per_house_m2&#39;</span><span class="p">:</span> <span class="n">land_size_per_house_m2</span><span class="p">,</span>
    <span class="s1">&#39;house_size_m2&#39;</span><span class="p">:</span> <span class="n">house_size_m2</span><span class="p">,</span>
    <span class="s1">&#39;floor_nos_each_house&#39;</span><span class="p">:</span> <span class="n">floor_nos_each_house</span>
    <span class="p">})</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;total_cost&#39;</span><span class="p">:</span> <span class="s1">&#39;IDR. </span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;net_return&#39;</span><span class="p">:</span> <span class="s1">&#39;IDR. </span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;roi&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
    <span class="s1">&#39;cost_per_house&#39;</span><span class="p">:</span> <span class="s1">&#39;IDR. </span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;house_nos&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;house_price&#39;</span><span class="p">:</span> <span class="s1">&#39;IDR. </span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;house_price_lower&#39;</span><span class="p">:</span> <span class="s1">&#39;IDR. </span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;house_price_upper&#39;</span><span class="p">:</span> <span class="s1">&#39;IDR. </span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;total_land_occupied&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;land_size_per_house_m2&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;house_size_m2&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;floor_nos_each_house&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span>
    <span class="p">}</span>
<span class="n">optimization_result_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;net_return&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_c6411">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_c6411_level0_col0" class="col_heading level0 col0" >location_tag</th>
      <th id="T_c6411_level0_col1" class="col_heading level0 col1" >total_cost</th>
      <th id="T_c6411_level0_col2" class="col_heading level0 col2" >net_return</th>
      <th id="T_c6411_level0_col3" class="col_heading level0 col3" >roi</th>
      <th id="T_c6411_level0_col4" class="col_heading level0 col4" >house_nos</th>
      <th id="T_c6411_level0_col5" class="col_heading level0 col5" >cost_per_house</th>
      <th id="T_c6411_level0_col6" class="col_heading level0 col6" >house_price</th>
      <th id="T_c6411_level0_col7" class="col_heading level0 col7" >house_price_lower</th>
      <th id="T_c6411_level0_col8" class="col_heading level0 col8" >house_price_upper</th>
      <th id="T_c6411_level0_col9" class="col_heading level0 col9" >avail_land_m2</th>
      <th id="T_c6411_level0_col10" class="col_heading level0 col10" >total_land_occupied</th>
      <th id="T_c6411_level0_col11" class="col_heading level0 col11" >land_size_per_house_m2</th>
      <th id="T_c6411_level0_col12" class="col_heading level0 col12" >house_size_m2</th>
      <th id="T_c6411_level0_col13" class="col_heading level0 col13" >floor_nos_each_house</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_c6411_level0_row0" class="row_heading level0 row0" >2</th>
      <td id="T_c6411_row0_col0" class="data row0 col0" >bogor_3</td>
      <td id="T_c6411_row0_col1" class="data row0 col1" >IDR. 9,400,000,001</td>
      <td id="T_c6411_row0_col2" class="data row0 col2" >IDR. 5,947,770,061</td>
      <td id="T_c6411_row0_col3" class="data row0 col3" >0.63</td>
      <td id="T_c6411_row0_col4" class="data row0 col4" >6</td>
      <td id="T_c6411_row0_col5" class="data row0 col5" >IDR. 1,566,666,667</td>
      <td id="T_c6411_row0_col6" class="data row0 col6" >IDR. 2,557,961,677</td>
      <td id="T_c6411_row0_col7" class="data row0 col7" >IDR. 1,811,071,649</td>
      <td id="T_c6411_row0_col8" class="data row0 col8" >IDR. 3,304,851,704</td>
      <td id="T_c6411_row0_col9" class="data row0 col9" >1000</td>
      <td id="T_c6411_row0_col10" class="data row0 col10" >1000.00</td>
      <td id="T_c6411_row0_col11" class="data row0 col11" >166.67</td>
      <td id="T_c6411_row0_col12" class="data row0 col12" >177.78</td>
      <td id="T_c6411_row0_col13" class="data row0 col13" >2</td>
    </tr>
    <tr>
      <th id="T_c6411_level0_row1" class="row_heading level0 row1" >3</th>
      <td id="T_c6411_row1_col0" class="data row1 col0" >bogor_4</td>
      <td id="T_c6411_row1_col1" class="data row1 col1" >IDR. 6,720,000,001</td>
      <td id="T_c6411_row1_col2" class="data row1 col2" >IDR. 5,558,216,049</td>
      <td id="T_c6411_row1_col3" class="data row1 col3" >0.83</td>
      <td id="T_c6411_row1_col4" class="data row1 col4" >14</td>
      <td id="T_c6411_row1_col5" class="data row1 col5" >IDR. 480,000,000</td>
      <td id="T_c6411_row1_col6" class="data row1 col6" >IDR. 877,015,432</td>
      <td id="T_c6411_row1_col7" class="data row1 col7" >IDR. 463,129,933</td>
      <td id="T_c6411_row1_col8" class="data row1 col8" >IDR. 1,290,900,931</td>
      <td id="T_c6411_row1_col9" class="data row1 col9" >800</td>
      <td id="T_c6411_row1_col10" class="data row1 col10" >800.00</td>
      <td id="T_c6411_row1_col11" class="data row1 col11" >57.14</td>
      <td id="T_c6411_row1_col12" class="data row1 col12" >60.95</td>
      <td id="T_c6411_row1_col13" class="data row1 col13" >2</td>
    </tr>
    <tr>
      <th id="T_c6411_level0_row2" class="row_heading level0 row2" >1</th>
      <td id="T_c6411_row2_col0" class="data row2 col0" >bogor_2</td>
      <td id="T_c6411_row2_col1" class="data row2 col1" >IDR. 5,395,000,000</td>
      <td id="T_c6411_row2_col2" class="data row2 col2" >IDR. 4,581,050,539</td>
      <td id="T_c6411_row2_col3" class="data row2 col3" >0.85</td>
      <td id="T_c6411_row2_col4" class="data row2 col4" >11</td>
      <td id="T_c6411_row2_col5" class="data row2 col5" >IDR. 490,454,545</td>
      <td id="T_c6411_row2_col6" class="data row2 col6" >IDR. 906,913,685</td>
      <td id="T_c6411_row2_col7" class="data row2 col7" >IDR. 489,330,480</td>
      <td id="T_c6411_row2_col8" class="data row2 col8" >IDR. 1,324,496,891</td>
      <td id="T_c6411_row2_col9" class="data row2 col9" >650</td>
      <td id="T_c6411_row2_col10" class="data row2 col10" >650.00</td>
      <td id="T_c6411_row2_col11" class="data row2 col11" >59.09</td>
      <td id="T_c6411_row2_col12" class="data row2 col12" >63.03</td>
      <td id="T_c6411_row2_col13" class="data row2 col13" >2</td>
    </tr>
    <tr>
      <th id="T_c6411_level0_row3" class="row_heading level0 row3" >7</th>
      <td id="T_c6411_row3_col0" class="data row3 col0" >depok_3</td>
      <td id="T_c6411_row3_col1" class="data row3 col1" >IDR. 4,980,000,000</td>
      <td id="T_c6411_row3_col2" class="data row3 col2" >IDR. 4,228,662,036</td>
      <td id="T_c6411_row3_col3" class="data row3 col3" >0.85</td>
      <td id="T_c6411_row3_col4" class="data row3 col4" >10</td>
      <td id="T_c6411_row3_col5" class="data row3 col5" >IDR. 498,000,000</td>
      <td id="T_c6411_row3_col6" class="data row3 col6" >IDR. 920,866,204</td>
      <td id="T_c6411_row3_col7" class="data row3 col7" >IDR. 501,535,688</td>
      <td id="T_c6411_row3_col8" class="data row3 col8" >IDR. 1,340,196,719</td>
      <td id="T_c6411_row3_col9" class="data row3 col9" >600</td>
      <td id="T_c6411_row3_col10" class="data row3 col10" >600.00</td>
      <td id="T_c6411_row3_col11" class="data row3 col11" >60.00</td>
      <td id="T_c6411_row3_col12" class="data row3 col12" >64.00</td>
      <td id="T_c6411_row3_col13" class="data row3 col13" >2</td>
    </tr>
    <tr>
      <th id="T_c6411_level0_row4" class="row_heading level0 row4" >9</th>
      <td id="T_c6411_row4_col0" class="data row4 col0" >jakut_2</td>
      <td id="T_c6411_row4_col1" class="data row4 col1" >IDR. 1,732,500,000</td>
      <td id="T_c6411_row4_col2" class="data row4 col2" >IDR. 4,177,145,373</td>
      <td id="T_c6411_row4_col3" class="data row4 col3" >2.41</td>
      <td id="T_c6411_row4_col4" class="data row4 col4" >2</td>
      <td id="T_c6411_row4_col5" class="data row4 col5" >IDR. 866,250,000</td>
      <td id="T_c6411_row4_col6" class="data row4 col6" >IDR. 2,954,822,686</td>
      <td id="T_c6411_row4_col7" class="data row4 col7" >IDR. 2,542,610,938</td>
      <td id="T_c6411_row4_col8" class="data row4 col8" >IDR. 3,367,034,435</td>
      <td id="T_c6411_row4_col9" class="data row4 col9" >150</td>
      <td id="T_c6411_row4_col10" class="data row4 col10" >112.50</td>
      <td id="T_c6411_row4_col11" class="data row4 col11" >56.25</td>
      <td id="T_c6411_row4_col12" class="data row4 col12" >60.00</td>
      <td id="T_c6411_row4_col13" class="data row4 col13" >2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>According to optimization result above, it can be seen that the <em>optimizer</em> prefers to maximize the number of houses to be produced, which tries to fully occupy the available land size. Interestingly, it also captures the potential profit of a small-sized area in <code class="docutils literal notranslate"><span class="pre">Jakarta</span> <span class="pre">Utara</span></code> given its predicted house price.</p>
<p>The specified <code class="docutils literal notranslate"><span class="pre">budget</span> <span class="pre">limit</span></code> seems a bit <code class="docutils literal notranslate"><span class="pre">overkills</span></code> if we consider the land specification of available locations. Above optimization result has found the maximum profit with total production cost only <span class="math notranslate nohighlight">\(Rp.\;9,400,000,00\)</span>. <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Division</span></code> possibly would be happy with this finding!</p>
<p>The lower and upper price interval above explains the average deviation of house price from its average price, for specified land and building size. Take an example for lower price at <code class="docutils literal notranslate"><span class="pre">bogor_4</span></code>, we can interpret that most homeowner agree that  <strong>type-60 house in Bogor</strong> with price tag <span class="math notranslate nohighlight">\(463,129,933\)</span>  is below average (don’t you think so?). This low price is because our dataset contains price of used house. But notice carefully that this is <strong>below the production cost</strong>.</p>
<p>Also note that if we select the model that is <code class="docutils literal notranslate"><span class="pre">biased</span></code>, which is overestimating the house price in our case, we would possibly overestimate the profit and the <em>optimizer</em> would select the wrong potential location. Fortunately we avoided that situation by carefully analyzing our dataset’s characteristics and applied the suitable model.</p>
<p>Of course, we can extend our problem to solve as reasonable and as much problem as we can imagine! Some interesting examples:</p>
<ul class="simple">
<li><p>Adding a new objective, let’s say search for solution to also minimize <em>duration of construction</em>, which can be a function of <em>house nums</em> and <em>house size</em>. Doing this <em>multiple-objectives</em> problem may requires further analysis steps or methods.</p></li>
<li><p>Some of the housing residents may need to provide <em>variation of house size</em>. The problem can be to find combination of numbers for each house size that maximize the land occupation and profit.</p></li>
</ul>
<p><a id="6-closing"> </a></p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="closing">
<h1>6. Closing<a class="headerlink" href="#closing" title="Permalink to this headline">#</a></h1>
<section id="conclusion">
<h2>6.1. Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>Above analysis shows that our dataset can be generalized by using Multiple Linear Regression Model, although Simple Linear Regression mostly gives comparable results.</p>
<p>For heterscedactic data, the Weighted Least Square is proven superior than ordinary least square to estimate slope coefficients. We should also select suitable inference method for this kind of data.</p>
<p>The purposefulness of linear model has been demonstrated in optimization function explained previously. Iterative process can be efficiently performed. Slight specification changes, which is common in project activity,  will affect insignificant development time and the result can be retrieved again quickly.</p>
</section>
<section id="further-improvement">
<h2>6.2. Further Improvement<a class="headerlink" href="#further-improvement" title="Permalink to this headline">#</a></h2>
<p>There are always rooms for improvements. <a href="#id11"><span class="problematic" id="id12">:cit:t:`atkinson2016`</span></a> provides iterative <em>Forward Search</em> algorithm using WLS to detect outliers accurately.</p>
<p>Model tuning is also necessary to create model that generalize well with unknown data. For linear regression model, one can implement <em>Regularization Terms</em> to the linear model. <em>Ridge Regression</em> and <em>Lasso Regression</em> are well-known regression that implement some type of regularizations.</p>
<p>The representativeness of the dataset to estimate population of Jabodetabek House Price plays a major role in this analysis. Variability that presents in our dataset can be determined more accurately by providing more observations to our model. Data limitation that is explained above is purposed to demonstrate possible problems that could arise and how to handle them accordingly. And yes, <em>scraping program</em> that is presented in this repository can be used to expand the dataset.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h1>7. References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h1>
<div class="docutils container" id="id13">
<dl class="citation">
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id5">ACD93</a></span></dt>
<dd><p>D.V. Hinkley A.C. Davidson. <em>Bootstrap Methods and their Application</em>. Cambride University Press, 1993.</p>
</dd>
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id1">ACA16</a></span></dt>
<dd><p>Francesca Torti Anthony C. Atkinsona, Marco Riani. Robust methods for heteroskedastic regression. <em>Computational Statistics and Data Analysis</em>, 104:209–222, 2016.</p>
</dd>
<dt class="label" id="id15"><span class="brackets">Dev21</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id6">2</a>,<a href="#id7">3</a>,<a href="#id9">4</a>)</span></dt>
<dd><p>Jay L. Devore. <em>Modern Mathematical Statistics with Applications</em>. Springer, 2021.</p>
</dd>
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id10">etal21</a></span></dt>
<dd><p>Gareth James et. al. <em>An Introduction to Statistical Learning</em>. Springer, 2021.</p>
</dd>
<dt class="label" id="id16"><span class="brackets">Fla03</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>,<a href="#id8">3</a>)</span></dt>
<dd><p>Emmanuel Flachaire. Bootstrapping heteroskedastic regression models: wild bootstrap vs. pairs bootstrap. <em>Computational Statistics and Data Analysis</em>, 49:361–376, 2003.</p>
</dd>
</dl>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="2%20-%20Data%20Exploration%20and%20Analysis.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><strong>Data Exploration and Analysis of House Price Offers</strong></p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Nafis Barizki<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>